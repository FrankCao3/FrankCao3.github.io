<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>计算机网络 | CCB</title><meta name="keywords" content="计算机基础"><meta name="author" content="ccb"><meta name="copyright" content="ccb"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="计算机网络"><meta name="application-name" content="计算机网络"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="计算机网络"><meta property="og:url" content="https://frankcao3.github.io/posts/28758.html"><meta property="og:site_name" content="CCB"><meta property="og:description" content="计算机网络计算机网络模型1.1 OSI参考模型国际标准化组织(ISO)提出的网络体系结构模型，称为开放系统互联参考模型(OSIRM)，通常简称为OSI参考模型。 OSI有七层，自下而上依次为物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。其中数据链路层在概念上常被划分为两个子层：逻辑链路"><meta property="og:locale" content="en"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="ccb"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="计算机网络计算机网络模型1.1 OSI参考模型国际标准化组织(ISO)提出的网络体系结构模型，称为开放系统互联参考模型(OSIRM)，通常简称为OSI参考模型。 OSI有七层，自下而上依次为物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。其中数据链路层在概念上常被划分为两个子层：逻辑链路"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://frankcao3.github.io/posts/28758"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":50,"languages":{"author":"Author: ccb","link":"Link: ","source":"Source: CCB","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'CCB',
  title: '计算机网络',
  postAI: '',
  pageFillDescription: '计算机网络, 计算机网络模型, 1.1 OSI参考模型, 1.2 TCPx2FIP模型, 传输层与socket基本操作, 2.1 传输层, UDP, TCP, 2.2 TCP连接的建立和终止, 三次握手建立连接, 四次挥手释放连接, 2.3 TCP状态转换图, 2.4 socket的基本操作, 网络层, 3.1 IPv4地址及网络地址转换NAT, IPv4, 网络地址转换, 3.2 子网划分与子网掩码、CIDR, 子网划分, 无分类编址CIDR, 3.3 ARP、RARP、ICMP, 3.4 IPv6, 网络常用测试工具, ping, tracert, telnet, netstat计算机网络计算机网络模型参考模型国际标准化组织提出的网络体系结构模型称为开放系统互联参考模型通常简称为参考模型有七层自下而上依次为物理层数据链路层网络层传输层会话层表示层应用层其中数据链路层在概念上常被划分为两个子层逻辑链路控制子层和媒体访问控制子层数据链路层负责分配地址地址或称物理地址由比特长个十六进制数字组成位前位十六进制是厂商向国际互联网工程任务组等机构申请用来标识厂商的代码地址的到位由厂商自行分派是各个厂商制造的所有网卡的一个唯一编号因此一个网卡会有一个全球唯一固定的地址但可对应多个地址地址的第位是组播地址标志位网络层负责对数据包进行路由选择和存储转发网络层的协议有等网络层数据的单位称为分组或数据包网络层提供点到点的通信直接相连的结点之间的通信仅提供一台机器到另一台机器之间的通信不会涉及程序或进程的概念传输层是第一个端到端即进程到进程的层次传输层提供应用进程间的逻辑通信由于一个主机可同时运行多个进程因此传输层有复用和分用的功能传输层的协议有等传输层数据的单位称为报文或数据段应用层为操作系统或者网络应用程序提供访问网络服务的接口应用层的协议有等参考模型功能协议设备物理层中继器集线器数据链路层分配地址网桥交换机网络层对数据包进行路由选择和存储转发点到点等路由器传输层提供进程间的逻辑通信端到端等网关是网络层以上的中继系统默认网关在网络层以上实现网络互连实质上是一个网络通向其他网络的地址模型模型由于得到广泛应用而成为事实上的国际标准从低到高依次为网络接口层网际层传输层和应用层七层模型和五层模型的对应关系如下网际层是体系结构的关键部分它和网络层在功能上非常相似网际层将分组发往任何网络并为之独立地选择合适的路由但它不保证各个分组有序到达各个分组的有序交付由高层负责网际层定义了标准的分组格式和协议即协议当前采用的协议是第版即它的下一个版本是传输层的功能同样和中的传输层类似是使发送端和目的端主机上的对等实体可以进行会话传输层主要使用以下两种协议传输控制协议它是面向连接的数据传输的单位是报文段能够提供可靠的交付用户数据报协议它是无连接的数据传输的单位是用户数据报不保证提供可靠的交付只能提供尽最大努力交付应用层包含所有的高层协议如虚拟终端协议文件传输协议域名解析服务电子邮件协议和超文本传输协议传输层与基本操作传输层在下图中展示了和从右向左观察这个图最右边的个网络应用使用另外的个网络应用使用最左边的网络应用直接使用分组过滤器或数据链路提供者接口同数据链路层进行通信使用协议用户数据报协议面向数据报文是一种无连接协议因为客户与服务器不必存在长期的关系例如一个客户创建一个套接字并发送一个数据报给一个服务器然后立即用同一个套接字发送另一个数据报给另外一个服务器同样一个服务器可以用同一个套接字从若干不同的客户一连串接受多个数据报是不可靠的不能保证最终到达它们的目的地不保证各个数据报的先后顺序跨网络保持不变也不保证每个数据报只到达一次既可以使用也可以使用传输控制协议面向字节流第一是一种面向连接的协议提供客户与服务器的连接第二提供可靠性当使用向另一端发送数据时它要求对端返回一个确认如果没有收到确认自动重传数据并等待更长时间在数次重传失败后才放弃第三通过给所发送数据的每一个字节关联一个序列号进行排序提供不可靠的数据报传送不提供确认序列号超时重传等机制第四提供流量控制而不提供流量控制总是告诉对端它能够接收多少字节的数据这称为通告窗口该窗口在任何时刻都指出接收缓冲区中的可用空间从而确保发送端发送的数据不会溢出接收缓冲区第五的连接是全双工的也可以是全双工的既可以使用也可以使用与的主要区别在于不一定提供可靠的数据传输事实上该协议不能保证数据准确无误地到达目的地在许多方面非常有效如具有对系统资源要求较少具有较好的实时性网络开销小的优点当某个程序的目标是尽快地传输尽可能多的信息时其中任意给定数据的重要性相对较低可使用连接的建立和终止以下给出了一个基本客户端和服务器程序的套接口函数对于服务器端其先调用函数返回一个套接字然后套接字与地址端口绑定对端口进行监听调用阻塞等待客户端连接这时如果有客户端调用函数返回一个套接字然后连接服务器如果连接成功客户端与服务器端的连接就建立了客户端发送数据请求服务器端接收请求并处理请求然后把响应数据发送给客户端客户端读取数据最后关闭连接一次交互结束三次握手建立连接客户端向服务器发送一个服务器向客户端响应一个并对进行确认客户端再向服务器发送一个确认从图中可以看出服务器必须准备好接受外来的连接这通过和函数来完成称为被动打开客户端通过调用进行主动打开这引起客户端向服务器发送了表示同步它告诉服务器客户将在连接中发送的数据的初始序列号分节这时进入阻塞状态服务器监听到连接请求即收到分节调用函数接受请求并向客户端发送它告诉客户端服务器将在连接中发送的数据的初始序列号分节这时进入阻塞状态客户端收到服务器的分节之后这时返回并对分节进行确认再向服务器发送分节服务器收到分节时返回至此三次握手完毕连接建立总结客户端的在三次握手的第二次返回而服务器端的在三次握手的第三次返回为什么不采用二次握手采用三次握手是为了防止失效的连接请求报文段突然又传送到服务器从而发生错误比如客户端第一次发送的连接请求并没有丢失而是因为网络问题导致延迟到达服务器服务器以为是客户端又发起的新连接于是服务器同意连接并向客服端发回确认但是此时客户端处于建立连接的状态所以不予理会服务器就一直等待客户端发送数据导致服务器的资源浪费四次挥手释放连接建立连接需要三次握手而终止连接需要四次挥手这是由的半关闭造成的既然连接是全双工的数据在两个方向可以同时传递因此每个方向必须单独地进行关闭下图中是客户执行主动关闭然而不管是客户还是服务器都可以执行主动关闭通常情况下是客户执行主动关闭但某些协议如则是服务器执行主动关闭具体步骤某个应用进程首先调用我们称这一端执行主动关闭这一端的于是发送一一个分节表示数据发送完毕另一端接收到分节之后执行被动关闭对这个进行确认它的接收也作为文件结束符传递给接收端应用进程因为的接收意味着应用进程在相应的连接上再也接收不到额外数据一段时间之后接收到文件结束符的应用进程调用关闭它的套接口这导致它的也发送一一个接收到这个的原发送端即执行主动关闭的那一端对它进行确认这样每个方向上都有一个和所以一共需要四个分节我们使用限定词一般是因为有时步骤的随数据一起发送另外执行被动关闭那一端的在步骤和发出的与也可以合并成一个分节当自己已经没有数据要发送了可以直接关闭连接这样的话就是三个报文完成连接的释放关闭时每一端都要发送一个这种情况除了在应用进程调用时会发生还会在进程终止时发生进程终止包括自愿调用或从函数返回不自愿进程收到一个终止本进程的信号的情况进程终止时所有打开的连接上都会发出一个释放连接为什么需要四次挥手关闭连接时当收到对方的报文通知时它仅仅表示对方没有数据发送给你了单方向但未必你所有的数据都全部发送给对方了所以你未必会马上关闭也即你可能还需要发送一些数据给对方之后再发送报文给对方来表示你没有数据发送给对方了针对每个报文都需要一次报文故需要四次挥手握手的过程中可以说没有信息数据的传输是一个相互应答的过程所以服务器会将一起发送但是客户端发送终止连接的时候很有可能服务器还有一些数据没有发送完所以服务器只是先答应但是需要等待数据传输完毕之后再发送报文和是分开的因此多了一次状态转换图连接的建立和终止可以用状态转换图来说明如图所示这些状态可使用显示它是一个在调试客户服务器应用时很有用的工具为一个连接定义了种状态并且规则规定如何基于当前状态及在该状态下所接收的分节从一个状态转换到另一个状态举例来说当某个应用进程在状态下执行主动打开时将发送一个且新的状态是如果这个接着接收到一个带的它将发送一个且新的状态是这个最终状态是绝大多数数据传送发生的状态自状态引出的两个箭头处理连接的终止如果某个应用进程在接收到文件结束符之前调用主动关闭那就转换到状态但如果某个应用进程在状态期间接收到一个被动关闭那就转换到状态图给出了一个完整的连接所发生的实际分组交换情况建立连接传送数据和终止连接图中展示了每个端点所经历的状态从图可见当客户端应用程序主动请求关闭时调用或关闭连接这时应用程序发送然后进入状态等待服务器端发送确认包接受到服务器端的以后然后客户端进入状态等待服务器端调用并发送当客户端接受到后发送进入最终的状态需要注意的是执行主动关闭的那一端进入状态留在的持续的时间是最长分节生命周期时间的倍也就是一般情况下是秒到分钟所以的时间一般为分钟存在状态有两个理由实现终止全双工连接的可靠性假设最终的丢失服务器将重发最终的因此客户必须维护状态信息以允许它重发最终的如果不维护状态信息它将响应以而服务器则把该分节解释成一个错误如果打算执行所有必要的工作以彻底终止某个连接上两个方向的数据流那么它必须能够处理连接终止序列四个分节中任何一个分节丢失的情况也即主动关闭的那一端必须进入状态因为它可能不得不重发最终的允许老的重复分节在网络中消逝我们假设端口和端口之间有一个连接我们关闭这个连接后在以后某个时候又重新建立起相同的地址和端口之间的连接后一个连接称为前一个连接的化身因为它们的地址和端口号是相同的必须防止来自某个连接的老重复分组在连接终止后再现从而被误解成属于同一个连接的化身被误解为属于新建的连接要实现这种功能不能给处于状态的连接启动新的化身既然状态的持续时间是这就足够让某个方向上的分组最多存活秒即被丢弃另一个方向上的应答最多存活秒也被丢弃通过实施这个规则我们就能保证当成功建立一个连接时来自该连接先前的化身的老重复分组都已在网络中消逝了的基本操作一个面向连接的客户端程序的主要步骤加载套接字库创建套接字向服务器发送连接请求和服务器端进行通信关闭套接字函数函数在成功时返回一个小的非负整数值称为套接口描述字简称套接字这个套接字跟文件描述字相似函数的三个参数分别为即协议域又称为协议族常用的协议族有或称域等协议族决定了套接口的地址类型在通信中必须采用对应的地址如决定了要用地址位的与端口号位的的组合决定了要用一个绝对路径名作为地址指定套接口类型常用的类型有等指定协议常用的协议有等它们分别对应传输协议传输协议传输协议注意上面的和并不是可以随意组合的如不可以跟组合当为时会自动选择类型对应的默认协议函数函数把一个本地协议地址赋予套接口对于网际协议协议地址是位的地址或位的地址与位的或端口号的组合函数的三个参数分别为即套接字它是通过函数创建的它唯一标识一个套接口一个指向特定于协议的地址结构的指针指出第二个参数中结构体的长度通常服务器在启动的时候都会绑定一个众所周知的地址如地址端口号用于提供服务客户就可以通过它来连接服务器而客户端就不用指定由系统自动分配一个端口号和自身的地址组合这就是什么三次握手时为服务器端在之前会调用而客户端就不调用而是在时由系统生成一个函数函数仅由服务器调用它做两件事情当函数创建一个套接口时它被假设为一个主动套接口也就是说它默认是一个将调用发起连接的客户套接口函数把一个未连接的套接口转换成一个被动套接口指示内核应接受指向该套接口的连接请求调用导致套接口从状态转换到状态函数的第二个参数规定了内核应该为相应套接口排队的最大连接个数后台等待连接队列的最大限制值包括已完成连接队列与未完成连接队列未完成连接队列每个这样的客户对应其中项客户已经发出建立连接请求且请求已到达服务器而服务器正在等待完成相应的三路握手过程服务器已发出第二个分节等待客户端的第三个分节这些套接字处于状态已完成连接队列每个已完成三路握手过程的客户对应其中项这些套接字处于状态函数客户用函数来建立与服务器的连接函数的第一个参数即为客户端的套接字第二参数为一个指向套接口地址结构的指针第三个参数为第二个参数中结构体的长度函数函数由服务器调用函数的第一个参数为服务器的套接字第二个参数用于返回客户端的协议地址第三个参数为协议地址的长度如果成功那么其返回值是由内核自动生成的一个全新的描述字代表与所返回客户的连接函数函数用来关闭套接口并终止连接一个套接口的默认行为是把该套接口标记为已关闭然后立即返回到调用进程该套接字不能再由调用进程使用也就是说不能再作为或的第一个参数注意操作只是使相应套接字的引用计数减只有当引用计数为的时候才会触发客户端向服务器发送终止连接请求激发的正常连接终止序列即发送函数关闭一个有种方法分别是与函数的原型是是需要关闭的套接口描述字参数允许为操作选择以下几种方式关闭连接的读端也就是该套接字不再接收数据任何当前在套接字接收缓冲区的数据将被丢弃但仍可写进程将不能对该套接字发出任何读操作调用之后接收到的任何数据将被确认然后无声丢弃掉注意此时并不发送关闭连接的写端进程不能再对此套接字发出写操作但仍可读对于的套接字这称为半关闭当前留在套接字发送缓冲区中的数据将被发送掉不管套接字的引用计数是否等于关闭写端的操作都会执行即会发送相当于调用两次第一次指定为第二次指定为和的区别会关闭连接并释放所有连接对应的资源套接字不能再由调用进程使用即它不能再作为或的参数而并不会释放掉套接字和所有的资源关闭读仍然可以关闭写仍然可以存在引用计数的概念调用时把套接字的引用计数减仅在该计数变为时才关闭套接字则不管引用计数直接使得该套接字不可用如果有别的进程企图使用该套接字将会受到影响的引用计数导致不一定会发出结束报文而则总是会发出结束报文这在我们打算关闭连接通知对端的时候是非常重要的函数同时终止两个方向的数据传送读和写可以只终止一个方向的数据传送的半关闭提供了连接的一端在结束它的发送后还能接收来自另一端数据的能力这就是所谓的半关闭半关闭是通过调用函数代替函数实现的图显示了一个半关闭的典型例子让左方的客户端开始半关闭当然也可以由另一端开始开始的两个报文和四次挥手一致初始端发出接着是另一端对这个的报文段但后面就和四次挥手不同因为接收半关闭的一方仍能发送数据我们只显示一个数据报文段和一个报文段但可能发送了许多数据报文段当收到半关闭的一端在完成它的数据传送后将发送一个关闭这个方向的连接这将传送一个文件结束符给发起这个半关闭的应用进程当对第二个进行确认后这个连接便彻底关闭了终止网络连接的通常方法是调用函数不过有两个限制通常可使用函数来避免无法直接终止连接函数把套接字的引用计数减仅在该计数变为时才关闭套接字使用参数为或时可以不管引用计数就激发的正常连接终止序列只能同时终止两个方向的数据传送函数同时终止数据传送的两个方向读和写但是连接是全双工的有时候我们需要关闭写但仍然可以继续读函数可以完成此工作注意如果有多个进程共享一个套接字每被调用一次计数减直到计数为时也就是所有进程都调用了套接字将被释放在多进程中如果一个进程调用后其他的进程将无法利用此套接字进行通信如果一个进程调用将不会影响到其他进程网络层地址及网络地址转换连接在的每台主机路由器都分配一个的全球唯一的标识符地址的编码方式有三种分类的地址子网的划分分类的地址传统的地址是分类的地址分为五类均由网络号和主机号组成网络号代表主机所连接到的网络主机号代表该主机或路由器在网络中的地址其中存在一些特殊的地址用于表示特殊用途不作为主机地址主机号全为表示本网络本身主机号全为表示本网络的广播地址网路保留作为环路自检地址表示任意主机本身全为即表示整个网络全为即表示整个网络的广播地址子网的划分在下一节叙述网络地址转换网络地址转换是通过将专用网络地址比如企业内部网转换为公用地址如互联网从而对外隐藏了内部管理的地址通过在内部使用非注册的地址私有地址并将它们转换为一小部分外部注册的地址公有地址从而减少地址注册的费用以及节省地址空间私有地址值用于局域网不用于无线局域网连接因此私有地址不能直接用于必须通过网关利用把私有地址转换为中合法的全球地址后才能用于私有地址有效地解决了地址不足的问题私有地址网段如下在因特网中的所有路由器对目的地址是私有地址的数据报一律不进行转发使用时需要在专用网连接到因特网的路由器上安装软件路由器至少有一个有效的外部全球地址普通路由器在转发数据报时不改变其源地址和目的地址且路由器工作在网络层而路由器在转发数据报时一定要更换其地址按路由器中的地址转换表转换源地址或目的地址路由器转发数据报时需要查看和转换传输层的端口其操作没有严格的层次关系子网划分与子网掩码子网划分各类地址的默认子网掩码类类类使用子网划分时的地址格式类网络位子网位主机位类网络位子网位主机位类网络位子网位主机位无分类编址分类的地址的缺点比如一个类地址对应的是个地址网络地址和广播地址这个是个天文数字一个公司或者组织是无法完全利用这么多地址的就造成了地址的浪费是在使用变长度子网掩码的基础上提出的一种消除传统类网络划分并且可以在软件的支持下实现超网构造的一种地址的网络划分方法这样可以大幅度提高地址空间的利率并减小路由表大小提高路由器的路由转发能力无分类编址的做法是将分为两部分网络前缀网络号对应的是一个网络地址一个网络可以容纳多个主机主机的网络号相同主机号唯一标识一个主机在一个网络中的怎么区分网络号和主机号呢使用斜线记法即地址网络前缀所占比特数在地址后边加入了代表前位为网络号的主要特点消除了传统的类地址以及子网的概念因而可以更加有效地分配的地址空间使用网络前缀概念代替子网络概念这样地址分为两部分网络前缀主机号使用斜线记法即地址网络前缀所占比特数其中网络前缀所占比特数对应于网络的部分等效于子网掩码中连续的部分将网络前缀都相同的连续的地址组成地址块一个地址块可以包括多个类地址这种地址的聚合称为路由聚合或称为构成超网路由聚合使得路由表中的一个项目可以表示很多个原来传统分类地址的路由有利于减少路由之间的路由选择信息的交换从而提高网络性能在实际网络的数据链路上传送数据时最终必须使用硬件地址所以需要一种方法来完成地址址到地址的映射这就要用到地址解析协议每台主机路由器上单独地存放一个从地址到地址的映射表称为表主机和路由器使用地址解析协议来动态维护此表地址转换为地址使用协议为了提高数据报成功交付的机会在网络层使用了网际控制报文协议来使得主机或路由器可以报告差错和异常情况命令工作在应用层但是直接使用网络层的协议而没有使用传输层的或协议由构成通常使用冒号十六进制记法表示地址每个的值用四位十六进制值表示各值之间用冒号分割如该表示方法允许使用零压缩即一连串连续的零可以为一对冒号所取代如可以写成地址可以写成这里冒号分割的是点分割的是所引入的主要变化更大的地址空间将地址从的增大到了扩展的地址层次结构灵活的首部格式改进的选项这一特征加快了分组处理速度允许协议继续扩充支持即插即用支持资源的预分配增加了安全性身份验证和保密验证是的关键特征分片限制为由源点来完成是端到端的路由途中的路由器不允许进行分片网络常用测试工具检查网络是否通畅或者网络的连接速度原理利用网络上机器地址的唯一性给目标地址发送一个数据包再要求对方返回一个同样大小的数据包来确定两台网络机器是否连接相通时延是多少是路由跟踪实用程序用于确定数据包访问目标所采取的路径命令用生存时间字段和错误消息来确定从一个主机到网络上其他主机的路由其命令格式如下可以使用命令确定数据包在网络上的停止位置例如则会打印出从当前主机到目的主机所经过的路由地址查看某个端口是否可访问协议是协议家族中的一员是远程登陆服务的标准协议和主要方式它为用户提供了在本地计算机上完成远程主机工作的能力例如可以用测试端口的服务器是否正常工作输入然后服务器响应然后输入如果服务器正常工作的话就会返回服务器的响应头以便你确认服务器的情况是一个监控网络的非常有用的工具它可以显示路由表实际的网络连接以及每一个网络接口设备的状态信息用于显示与和协议相关的统计数据一般用于检验本机各端口的网络连接情况使用格式为一般用来显示所有连接的端口并用数字表示',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-05 19:40:46',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="CCB" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">CCB</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/DVWA%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">DVWA靶场<sup>10</sup></a><a href="/tags/%E5%AE%9E%E8%AE%AD-%E7%BD%91%E7%BB%9C%E5%BB%BA%E8%AE%BE%E9%83%A8%E5%88%86/" style="font-size: 1.05rem;">实训-网络建设部分<sup>7</sup></a><a href="/tags/%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" style="font-size: 1.05rem;">搭建博客<sup>1</sup></a><a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 1.05rem;">机器学习<sup>1</sup></a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 1.05rem;">渗透测试<sup>15</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">计算机基础<sup>5</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">October 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">August 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">15</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/07/"><span class="card-archive-list-date">July 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/08/"><span class="card-archive-list-date">August 2021</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/08/"><span class="card-archive-list-date">August 2020</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>计算机基础</span></a></span></div></div><h1 class="post-title" itemprop="name headline">计算机网络</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2021-08-14T16:00:00.000Z" title="Created 2021-08-15 00:00:00">2021-08-15</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-10-05T11:40:46.710Z" title="Updated 2023-10-05 19:40:46">2023-10-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://frankcao3.github.io/posts/28758"><header><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" tabindex="-1" itemprop="url">计算机基础</a><h1 id="CrawlerTitle" itemprop="name headline">计算机网络</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">ccb</span><time itemprop="dateCreated datePublished" datetime="2021-08-14T16:00:00.000Z" title="Created 2021-08-15 00:00:00">2021-08-15</time><time itemprop="dateCreated datePublished" datetime="2023-10-05T11:40:46.710Z" title="Updated 2023-10-05 19:40:46">2023-10-05</time></header><h1 id="计算机网络"><a href="#计算机网络" class="headerlink" title="计算机网络"></a>计算机网络</h1><h2 id="计算机网络模型"><a href="#计算机网络模型" class="headerlink" title="计算机网络模型"></a>计算机网络模型</h2><h3 id="1-1-OSI参考模型"><a href="#1-1-OSI参考模型" class="headerlink" title="1.1 OSI参考模型"></a>1.1 OSI参考模型</h3><p><strong>国际标准化组织(ISO)<strong>提出的网络体系结构模型，称为开放系统互联参考模型(OSIRM)，通常简称为</strong>OSI参考模型</strong>。</p>
<p>OSI有七层，自下而上依次为物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。其中数据链路层在概念上常被划分为两个子层：逻辑链路控制子层(LLC)和媒体访问控制子层(MAC)。</p>
<p><strong>数据链路层负责分配MAC地址。</strong>MAC地址，或称物理地址，由<strong>48比特长</strong>，12个十六进制数字组成，<strong>0~23位(前6位十六进制)是厂商向IETF（ 国际互联网工程任务组）等机构申请用来标识厂商的代码</strong>。地址的24到47位由厂商自行分派，是各个厂商制造的所有网卡的一个唯一编号。 因此一个<br>网卡会有一个全球唯一固定的MAC地址，但可对应多个IP地址。MAC地址的第48位是组播地址标志位。</p>
<p><strong>网络层负责对数据包进行路由选择和存储转发</strong>，网络层的协议有: IP、IPX、ICMP、IGMP、ARP、RARP、OSPF 等。网络层数据的单位称为<u>分组或数据包</u>。网络层提供点到点的通信（直接相连的结点之间的通信），仅提供一台机器到另一台机器之间的通信，不会涉及程序或进程的概念。</p>
<p><strong>传输层是第一个<u>端到端</u>，即进程到进程的层次</strong>。传输层提供应用进程间的逻辑通信。由于一个主机可同时运行多个进程，因此传输层有复用和分用的功能。传输层的协议有: TCP、 UDP、 SCTP 等。传输层数据的单位称为<u>报文或数据段</u>。</p>
<p>应用层为操作系统或者网络应用程序提供访问网络服务的接口。应用层的协议有: RIP、TELNET、FTP、HTTP、SNMP等。</p>
<table>
<thead>
<tr>
<th>OSI参考模型</th>
<th>功能</th>
<th>协议</th>
<th>设备</th>
</tr>
</thead>
<tbody><tr>
<td>物理层</td>
<td></td>
<td></td>
<td>中继器、集线器</td>
</tr>
<tr>
<td>数据链路层</td>
<td>分配MAC地址</td>
<td></td>
<td>网桥、交换机</td>
</tr>
<tr>
<td>网络层</td>
<td>对数据包进行路由选择和存储转发（点到点）</td>
<td>IP、IPX、ICMP、IGMP、ARP、RARP、OSPF等</td>
<td>路由器</td>
</tr>
<tr>
<td>传输层</td>
<td>提供进程间的逻辑通信（端到端）</td>
<td>TCP、 UDP、 SCTP等</td>
<td></td>
</tr>
</tbody></table>
<p><strong>网关</strong>是网络层以上的中继系统。默认网关在网络层以上实现网络互连，实质上是一个网络通向其他网络的IP地址。</p>
<h3 id="1-2-TCP-x2F-IP模型"><a href="#1-2-TCP-x2F-IP模型" class="headerlink" title="1.2 TCP&#x2F;IP模型"></a>1.2 TCP&#x2F;IP模型</h3><p>TCP&#x2F;IP模型由于得到广泛应用而成为事实上的国际标准，从低到高依次为：网络接口层、网际层、传输层和应用层。</p>
<p>OSI七层模型和TCP&#x2F;IP五层模型的对应关系如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220704093830695.png" alt="image-20220704093830695"></p>
<p><strong>网际层</strong>是TCP&#x2F;IP体系结构的关键部分。它和OSI网络层在功能上非常相似。网际层<strong>将分组发往任何网络，并为之独立地选择合适的路由，但它不保证各个分组有序到达，各个分组的有序交付由高层负责</strong>。网际层定义了标准的分组格式和协议，即IP协议。当前采用的IP协议是第4版，即IPv4，它的下一-个版本是IPv6。</p>
<p><strong>传输层</strong>的功能同样和OSI中的传输层类似，是<strong>使发送端和目的端主机上的对等实体可以进行会话</strong>。</p>
<p>传输层主要使用以下两种协议:</p>
<ul>
<li>传输控制协议（Transmission Control Protocol, TCP）。 它是面向连接的，数据传输的单位是报文段，能够提供可靠的交付。</li>
<li>用户数据报协议(User Datagram Protocol, UDP)。 它是无连接的，数据传输的单位是用户数据报，不保证提供可靠的交付，只能提供“尽最大努力交付”。</li>
</ul>
<p><strong>应用层</strong>包含所有的高层协议。如虚拟终端协议(Telnet)、 文件传输协议(FTP)、 域名解析服务(DNS)、电子邮件协议(SMTP)和超文本传输协议(HTTP)。</p>
<h2 id="传输层与socket基本操作"><a href="#传输层与socket基本操作" class="headerlink" title="传输层与socket基本操作"></a>传输层与socket基本操作</h2><h3 id="2-1-传输层"><a href="#2-1-传输层" class="headerlink" title="2.1 传输层"></a>2.1 传输层</h3><p>在下图中，展示了IPv4和IPv6。从右向左观察这个图，最右边的4个网络应用使用IPv6，另外的5个网络应用使用IPv4。</p>
<p>最左边的网络应用tpdump直接使用BPF（BSD分组过滤器）或DLPI（数据链路提供者接口）同数据链路层进行通信。ping使用ICMP协议。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220704094553193.png" alt="image-20220704094553193"></p>
<h5 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h5><p>用户数据报协议(User Datagram Protocol)，<strong>面向数据报文</strong>。UDP是一种<strong>无连接</strong>协议，因为UDP客户与服务器不必存在长期的关系，例如一个UDP客户创建一个套接字并发送一个数据报给一个服务器，然后立即用同一个套接字发送另一个数据报给另外一个服务器。同样，一个UDP服务器可以用同一个UDP套接字从若干不同的客户一连串接受多个数据报。</p>
<p>UDP是<strong>不可靠</strong>的，不能保证最终到达它们的目的地，<strong>不保证各个数据报的先后顺序跨网络保持不变，也不保证每个数据报只到达一次</strong>。</p>
<p>UDP既可以使用IPv4,也可以使用IPv6。</p>
<h5 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h5><p>传输控制协议(Transmission Control Protocol)，<strong>面向字节流</strong>。</p>
<p>第一，TCP 是一种<strong>面向连接</strong>的协议，提供客户与服务器的连接。</p>
<p>第二，TCP提供<strong>可靠性</strong>。当使用TCP向另一端发送数据时，它要求对端返回一个确认。如果没有收到确认，TCP自动重传数据并等待更长时间。在数次重传失败后，TCP才放弃。</p>
<p>第三，TCP通过<strong>给所发送数据的每一个字节关联一个序列号进行排序</strong>。UDP提供不可靠的数据报传送，不提供确认、序列号、超时重传等机制。</p>
<p>第四，TCP<strong>提供流量控制</strong>，而UDP不提供流量控制。TCP总是告诉对端它能够接收多少字节的数据，这称为<strong>通告窗口</strong>。该窗口在任何时刻都指出接收缓冲区中的可用空间，从而确保发送端发送的数据不会溢出接收缓冲区。</p>
<p>第五，TCP的连接是全双工的。UDP也可以是全双工的。</p>
<p>TCP既可以使用IPv4，也可以使用IPv6。</p>
<p><strong>UDP与TCP的主要区别在于UDP不一定提供可靠的数据传输</strong>。事实上，该协议不能保证数据准确无误地到达目的地。UDP在许多方面非常有效，如UDP具有对系统资源要求较少、具有较好的实时性、网络开销小的优点。当某个程序的目标是尽快地传输尽可能多的信息时(其中任意给定数据的重要性相对较低)，可使用UDP。</p>
<h3 id="2-2-TCP连接的建立和终止"><a href="#2-2-TCP连接的建立和终止" class="headerlink" title="2.2 TCP连接的建立和终止"></a>2.2 TCP连接的建立和终止</h3><p>以下给出了一个基本TCP客户端和服务器程序的套接口函数：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220704095345763.png" alt="image-20220704095345763"></p>
<p>对于服务器端，其先调用socket函数（返回一个套接字），然后套接字与地址、端口绑定（bind），对端口进行监听（listen），调用accept阻塞，等待客户端连接。</p>
<p>这时如果有客户端调用socket函数（返回一个套接字），然后连接服务器（connect），如果连接成功，客户端与服务器端的连接就建立了。客户端发送数据请求，服务器端接收请求并处理请求，然后把响应数据发送给客户端，客户端读取数据，最后关闭连接，一次交互结束。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220704100516344.png" alt="image-20220704100516344"></p>
<h4 id="三次握手建立连接"><a href="#三次握手建立连接" class="headerlink" title="三次握手建立连接"></a>三次握手建立连接</h4><hr>
<ul>
<li>客户端向服务器发送一个SYN J；</li>
<li>服务器向客户端响应一个SYN K，并对SYN J进行确认ACK J+1；</li>
<li>客户端再向服务器发送一个确认ACK K+1。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220704100639833.png" alt="image-20220704100639833"></p>
<p>从图中可以看出，服务器必须准备好接受外来的连接。这通过socket、bind 和listen函数来完成，称为<strong>被动打开</strong>。</p>
<p>客户端通过<strong>调用connect进行主动打开</strong>。这引起客户端向服务器发送了SYN J （表示同步，它告诉服务器客户将在连接中发送的数据的初始序列号）分节，这时connect进入阻塞状态。</p>
<p>服务器监听到连接请求，即收到SYN J分节，<strong>调用accept函数接受请求</strong>，并向客户端发送SYN K （它告诉客户端服务器将在连接中发送的数据的初始序列号）、ACK J+1分节，这时accept进入阻塞状态。</p>
<p>客户端收到服务器的SYN K、ACK J+1 分节之后，这时<strong>connect返回</strong>，并对SYN K分节进行确认，再向服务器发送ACK K+1分节；</p>
<p>服务器收到ACK K+1分节时，<strong>accept 返回</strong>，至此三次握手完毕，连接建立。</p>
<p>总结：客户端的connect在三次握手的第二次返回，而服务器端的accept在三次握手的第三次返回。</p>
<p>&#x3D;&#x3D;<strong>TCP为什么不采用二次握手：</strong>&#x3D;&#x3D;</p>
<p>采用三次握手是为了防止失效的连接请求报文段突然又传送到服务器，从而发生错误。</p>
<p>比如，客户端第一次发送的连接请求并没有丢失，而是因为网络问题导致延迟到达服务器，<u>服务器以为是客户端又发起的新连接</u>，于是服务器同意连接，并向客服端发回确认，但是此时客户端处于建立连接的状态，所以不予理会，服务器就一直等待客户端发送数据， 导致服务器的资源浪费。</p>
<h4 id="四次挥手释放连接"><a href="#四次挥手释放连接" class="headerlink" title="四次挥手释放连接"></a>四次挥手释放连接</h4><hr>
<p><strong>&#x3D;&#x3D;建立连接需要三次握手，而终止连接需要四次挥手。这是由TCP的半关闭造成的。既然TCP连接是全双工的（数据在两个方向可以同时传递），因此每个方向必须单独地进行关闭。&#x3D;&#x3D;</strong></p>
<p>下图中是客户执行主动关闭，然而不管是客户还是服务器都可以执行主动关闭。通常情况下是客户执行主动关闭，但某些协议如HTTP则是服务器执行主动关闭。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220704101542526.png" alt="image-20220704101542526"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://images.xiaozhuanlan.com/photo/2020/42b857c3a2046b9907075e326125d662.png" alt="img"></p>
<p>具体步骤: </p>
<ol>
<li><p>某个应用进程首先调用close，我们称这一端执行<strong>主动关闭</strong>。 这一端的TCP于是发送一一个FIN分节，表示数据发送完毕；</p>
</li>
<li><p>另一端接收到FIN分节之后，执行<strong>被动关闭</strong>，对这个FIN进行ACK确认。它的接收也作为文件结束符传递给接收端应用进程，因为<u>FIN的接收意味着应用进程在相应的连接上再也接收不到额外数据</u>；</p>
</li>
<li><p><strong><u>一段时间之后</u><strong>，接收到文件结束符的应用进程调用close关闭它的套接口。这导致它的TCP</strong>也发送一一个FIN</strong>；</p>
</li>
<li><p>接收到这个FIN的原发送端TCP (即执行主动关闭的那一端) 对它<strong>进行确认</strong>。</p>
</li>
</ol>
<p>这样<strong>每个方向上都有一个FIN和ACK，所以一共需要四个分节</strong>。我们使用限定词“一般”是因为：有时步骤1)的FIN随数据一起发送；另外，执行被动关闭那一端的TCP在步骤2)和3)发出的ACK与FIN也可以合并成一个分节（当自己已经没有数据要发送了，可以直接关闭连接），这样的话就是三个报文完成连接的释放。</p>
<p>TCP关闭时，每一端都要发送一个FIN。这种情况除了在应用进程调用close时会发生，还会在进程终止时发生。进程终止包括自愿（调用exit或从main函数返回）、不自愿（进程收到一个终止本进程的信号）的情况，进程终止时所有打开的TCP连接上都会发出一个FIN。</p>
<p>&#x3D;&#x3D;<strong>TCP释放连接为什么需要四次挥手：</strong>&#x3D;&#x3D;</p>
<p>关闭连接时，<u>当收到对方的FIN报文通知时，它仅仅表示对方没有数据发送给你了</u>（单方向），但未必你所有的数据都全部发送给对方了，所以<u>你未必会马上关闭socket，也即你可能还需要发送一些数据给对方之后，再发送FIN报文给对方来表示你没有数据发送给对方了</u>，针对每个FIN报文，都需要一次ack报文，故需要四次挥手。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/whuchris/Interview/blob/master/Java/TCP%E5%92%8CUDP%E5%8D%8F%E8%AE%AE.md">https://github.com/whuchris/Interview/blob/master/Java/TCP%E5%92%8CUDP%E5%8D%8F%E8%AE%AE.md</a></p>
<p>握手的过程中可以说没有信息数据的传输，是一个相互应答的过程，所以服务器会将SYN ACK一起发送，但是客户端发送终止连接的时候，很有可能服务器还有一些数据没有发送完，所以服务器只是先答应，但是需要等待数据传输完毕之后再发送FIN报文，ACK和FIN是分开的，因此多了一次。</p>
<h3 id="2-3-TCP状态转换图"><a href="#2-3-TCP状态转换图" class="headerlink" title="2.3 TCP状态转换图"></a>2.3 TCP状态转换图</h3><hr>
<p>TCP连接的建立和终止可以用状态转换图来说明，如图2-5所示。这些状态可使用netstat显示，它是一个在调试客户&#x2F;服务器应用时很有用的工具。</p>
<p>TCP为一个连接定义了11种状态，并且TCP规则规定如何基于当前状态及在该状态下所接收的分节从一个状态转换到另一个状态。举例来说，当某个应用进程在CLOSED状态下执行主动打开时，TCP将发送一个SYN，且新的状态是SYN_ SENT。如果这个TCP接着接收到一个带ACK的SYN，它将发送一个ACK，且新的状态是ESTABLISHED。这个最终状态是绝大多数数据传送发生的状态。</p>
<p>自ESTABLISHED状态引出的两个箭头处理连接的终止。如果某个应用进程在接收到文件结束符之前调用close (主动关闭)，那就转换到FIN _WAIT_1状态。但如果某个应用进程在ESTABLISHED状态期间接收到一个FIN (被动关闭),那就转换到CLOSE WAIT状态。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220704104439563.png" alt="image-20220704104439563"></p>
<p>图2-6给出了一个完整的TCP连接所发生的实际分组交换情况：建立连接、传送数据和终止连接。图中展示了每个端点所经历的TCP状态。从图2-6可见，当客户端应用程序主动请求关闭时，调用close或shutdown关闭连接，这时应用程序发送FIN，然后进入FIN_WAIT_1状态，等待服务器端发送确认包ACK，接受到服务器端的ACK以后，然后客户端进入FIN_WAIT_2状态，等待服务器端调用close, 并发送FIN,当客户端接受到FIN后，发送ACK，进入最终的TIME_WAIT状态。</p>
<p>需要注意的是，执行主动关闭的那一端进入&#x3D;&#x3D;TIME WAIT状态&#x3D;&#x3D;。<strong>留在TIME_ WAIT的持续的时间是&#x3D;&#x3D;MSL&#x3D;&#x3D; (最长分节生命周期Maximum Segment Liftime)时间的2倍，也就是2MSL。</strong>MSL一般情况下是30秒到2分钟，所以TIME_WAIT的时间一般为1~4分钟。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220704154040857.png" alt="image-20220704154040857"></p>
<p>&#x3D;&#x3D;<strong>存在TIME_WAIT状态有两个理由：</strong>&#x3D;&#x3D;</p>
<ul>
<li><p>实现终止TCP全双工连接的可靠性</p>
<p><u>假设最终的ACK丢失，服务器将重发最终的FIN，因此客户必须维护状态信息以允许它重发最终的ACK</u>。如果不维护状态信息，它将响应以RST，而服务器则把该分节解释成一个错误。 如果TCP打算执行所有必要的工作以彻底终止某个连接上两个方向的数据流，那么它必须能够处理连接终止序列四个分节中任何一个分节丢失的情况，也即主动关闭的那一端必须进入TIME_WAIT状态，因为它可能不得不重发最终的ACK。</p>
</li>
<li><p>允许老的重复分节在网络中消逝</p>
<p>我们假设12.106.32.254端口1500和206.168.112.219端口21之间有一个TCP连接，我们关闭这个连接后，在以后某个时候又重新建立起相同的IP地址和端口之间的TCP连接。后一个连接称为前一个连接的化身，因为它们的IP地址和端口号是相同的，<u>TCP必须防止来自某个连接的老重复分组在连接终止后再现，从而被误解成属于同一个连接的化身（被误解为属于新建的连接）。</u>要实现这种功能，TCP不能给处于TIME_WAIT状态的连接启动新的化身，<u>既然TME_WAIT状态的持续时间是2MSL，这就足够让某个方向上的分组最多存活MSL秒即被丢弃，另一个方向上的应答最多存活MSL秒也被丢弃</u>，通过实施这个规则，我们就能保证当成功建立一个 TCP连接时，来自该连接先前的化身的老重复分组都已在网络中消逝了。</p>
</li>
</ul>
<h3 id="2-4-socket的基本操作"><a href="#2-4-socket的基本操作" class="headerlink" title="2.4 socket的基本操作"></a>2.4 socket的基本操作</h3><hr>
<p>一个面向连接的客户端socket程序的主要步骤：</p>
<ol>
<li><p>加载套接字库</p>
</li>
<li><p>创建套接字socket()</p>
</li>
<li><p>向服务器发送连接请求connect()</p>
</li>
<li><p>和服务器端进行通信</p>
</li>
<li><p>关闭套接字close()</p>
</li>
</ol>
<ol>
<li><p><strong>socket()函数</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">socket</span><span class="params">(<span class="type">int</span> domain, <span class="type">int</span> type, <span class="type">int</span> protocol)</span></span>;</span><br></pre></td></tr></table></figure>

<p>socket函数在成功时返回一个小的非负整数值，称为套接口描述字(Socket Descriptor)， 简称套接字。这个套接字跟文件描述字相似。</p>
<p>socket函数的三个参数分别为:</p>
<ol>
<li><p><strong>domain</strong>：即协议域，又称为协议族(family)。常用的协议族有: AF_ INET、 AF_ INET6、AF LOCAL（或称AF_ UNIX，UNIX域socket）、AF_ ROUTE等。协议族决定了套接口的地址类型，在通信中必须采用对应的地址，如AF_ INET决定了要用IPv4地址(32位的)与端口号(16位的)的组合、AF_UNIX决定了要用一个绝对路径名作为地址。</p>
</li>
<li><p><strong>type</strong>：指定套接口类型。常用的socket类型有: SOCK_STREAM、SOCK_DGRAM、SOCK_RAW、SOCK_SEQPACKET等。</p>
</li>
<li><p><strong>protocol</strong>：指定协议。常用的协议有: IPPROTO_TCP、IPPTOTO_UDP、IPPROTO_SCTP等，它们分别对应TCP传输协议、UDP传输协议、SCTP传输协议。</p>
</li>
</ol>
<p><strong>注意</strong>：上面的type 和protocol 并不是可以随意组合的，如SOCK_ STREAM不可以跟IPPROTO_ UDP组合。当protocol为0时，会自动选择type类型对应的默认协议。</p>
</li>
<li><p><strong>bind()函数</strong></p>
<p>bind函数<strong>把一个本地协议地址赋予套接口</strong>。对于网际协议，协议地址是32位的IPv4地址或128位的IPv6地址与16位的TCP或UDP端口号的组合。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">bind</span> <span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *addr, <span class="type">socklen_t</span> addrlen)</span> </span>;</span><br></pre></td></tr></table></figure>

<p>函数的三个参数分别为：</p>
<ol>
<li><p>sockfd：即套接字，它是通过socket()函数创建的，它唯一标识一个套接口。</p>
</li>
<li><p>addr：一个指向特定于协议的地址结构的指针。</p>
</li>
<li><p>addrlen：指出第二个参数中结构体的长度。</p>
</li>
</ol>
<p>通常服务器在启动的时候都会绑定一个众所周知的地址(如IP地址+端口号)，用于提供服务，客户就可以通过它来连接服务器；而客户端就不用指定，由系统自动分配一个端口号和自身的IP地址组合。**&#x3D;&#x3D;这就是什么三次握手时为服务器端在listen之前会调用bind，而客户端就不调用，而是在connect时由系统生成一个。&#x3D;&#x3D;**</p>
</li>
<li><p><strong>listen()函数</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">listen</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">int</span> backlog)</span></span></span><br></pre></td></tr></table></figure>

<p>listen函数仅由TCP服务器调用，它做两件事情：</p>
<ol>
<li><p>当socket函数创建一个套接口时，它被假设为一个主动套接口，也就是说，它默认是一个将调用connect发起连接的客户套接口。listen函数把一个未连接的套接口<strong>转换成一个被动套接口</strong>，指示内核应接受指向该套接口的连接请求。调用listen导致套接口从CLOSED状态转换到LISTEN状态。</p>
</li>
<li><p>listen函数的<strong>第二个参数backlog规定了内核应该为相应套接口排队的最大连接个数</strong>（后台等待连接队列的最大限制值）(包括已完成连接队列与未完成连接队列)。</p>
</li>
</ol>
<ul>
<li><p>未完成连接队列。</p>
<p>每个这样的客户对应其中- -项:客户已经发出建立连接请求，且请求已到达服务器，而服务器正在等待完成相应的TCP三路握手过程(服务器已发出第二个分节，等待客户端的第三个分节)。这些套接字处于SYN_ RCVD状态。</p>
</li>
<li><p>已完成连接队列。</p>
<p>每个已完成TCP三路握手过程的客户对应其中- -项。这些套接字处于ESTABLISHED状态。</p>
</li>
</ul>
</li>
<li><p><strong>connect()函数</strong></p>
<p>TCP客户用connect函数来<strong>建立与TCP服务器的连接</strong>。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">connect</span> <span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *addr, <span class="type">socklen_t</span> addrlen)</span></span>;</span><br></pre></td></tr></table></figure>


<p>connect函数的第一个参数即为客户端的套接字，第二参数为一个指向套接口地址结构的指针，第三个参数为第二个参数中结构体的长度。</p>
</li>
<li><p><strong>accept()函数</strong></p>
<p>accept函数由TCP服务器调用。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">accept</span> <span class="params">(<span class="type">int</span> sockfd, <span class="keyword">struct</span> sockaddr addr, <span class="type">socklen_t</span> addrlen)</span> </span>;</span><br></pre></td></tr></table></figure>

<p>accept函数的第一个参 数为服务器的套接字，第二个参数用于返回客户端的协议地址，第三个参数为协议地址的长度。</p>
<p>如果accept成功，那么其返回值是由内核自动生成的<strong>一个全新的描述字</strong>，代表与所返回客户的TCP连接。</p>
</li>
<li><p><strong>close()函数</strong></p>
<p>close函数用来关闭套接口，并终止TCP连接。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">close</span><span class="params">(<span class="type">int</span> fd)</span></span>;</span><br></pre></td></tr></table></figure>

<p>close一个TCP套接口的默认行为是把该套接口标记为已关闭，然后立即返回到调用进程。<strong>该套接字<u>不能再由调用进程使用</u><strong>，也就是说不能再作为read或write的第-一个参数。<br>注意：close操作</strong>只是使相应套接字的引用计数减1</strong>，<u>只有当引用计数为0的时候，才会触发TCP客户端向服务器发送终止连接请求</u>（激发TCP的正常连接终止序列,即发送FIN)）。</p>
</li>
<li><p><strong>shutdown()函数</strong></p>
<p>关闭一个socket有2种方法，分别是close与shutdown。</p>
<p>shutdown函数的原型是：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">shutdown</span> <span class="params">(<span class="type">int</span> sockfd, <span class="type">int</span> howto)</span></span>;</span><br></pre></td></tr></table></figure>

<p>sockfd是需要关闭的套接口描述字。参数howto允许为shutdown操作选择以下几种方式:</p>
<p>SHUT_RD：关闭连接的读端。也就是该套接字不再接收数据，任何当前在套接字接收缓冲区的数据将被丢弃，但仍可写。进程将不能对该套接字发出任何读操作。调用之后接收到的任何数据将被确认然后无声丢弃掉。注意此时并不发送FIN。</p>
<p>SHUT_WR：关闭连接的写端，进程不能再对此套接字发出写操作，但仍可读。对于TCP的套接字(socket)， 这称为半关闭，当前留在套接字发送缓冲区中的数据将被发送掉。不管套接字的引用计数是否等于0,关闭写端的操作都会执行，即会发送FIN。</p>
<p>SHUT_ RDWR：相当于调用shutdown两次：第一次指定howto为SHUT_ RD，第二次指定howto为SHUT_WR。</p>
<p><strong>&#x3D;&#x3D;close和shutdown的区别：&#x3D;&#x3D;</strong></p>
<ul>
<li>close 会关闭连接，并释放所有连接对应的资源，**套接字<u>不能再由调用进程使用</u>**，即它不能再作为read或write的参数；而 shutdown 并不会释放掉套接字和所有的资源，关闭读仍然可以write，关闭写仍然可以read。</li>
<li><strong>close 存在引用计数</strong>的概念，调用时把套接字的引用计数减1，<strong>仅在该计数变为0时才关闭套接字</strong>；<strong>shutdown 则不管引用计数，直接使得该套接字不可用</strong>，如果有别的进程企图使用该套接字，将会受到影响。</li>
<li>close 的引用计数导致<strong>不一定会发出 FIN 结束报文</strong>，而 <strong>shutdown 则总是会发出 FIN 结束报文</strong>，这在我们打算关闭连接通知对端的时候，是非常重要的。</li>
<li><strong>close函数同时终止两个方向的数据传送：读和写。shutdown可以只终止一个方向的数据传送。</strong></li>
</ul>
</li>
<li><p><strong>TCP的半关闭</strong></p>
<p>TCP提供了连接的一端在结束它的发送后还能接收来自另一端数据的能力。这就是所谓的半关闭，<strong>半关闭是通过调用shutdown函数代替close函数实现的</strong>。</p>
<p>图2-7显示了一个半关闭的典型例子。让左方的客户端开始半关闭，当然也可以由另一端开始。开始的两个报文和四次挥手一致，初始端发出FIN，接着是另一端对这个FIN的ACK报文段。但后面就和四次挥手不同，因为接收半关闭的一方仍能发送数据。我们只显示一个数据报文段和一个ACK报文段，但可能发送了许多数据报文段。当收到半关闭的一端在完成它的数据传送后， 将发送一个 FIN<br>关闭这个方向的连接，这将传送一个文件结束符给发起这个半关闭的应用进程。当对第二个FIN进行确认后，这个连接便彻底关闭了。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220704181311157.png" alt="image-20220704181311157"></p>
<p>终止网络连接的通常方法是调用close 函数。不过&#x3D;&#x3D;<strong>close有两个限制</strong>，通常可使用shutdown 函数来避免&#x3D;&#x3D;。</p>
<ul>
<li><p><strong>close无法直接终止连接</strong></p>
<p>close函数把套接字的引用计数减1，<strong>仅在该计数变为0时才关闭套接字</strong>。</p>
<p>使用shutdown（howto参数为SHUT_RDWR或SHUT_WR时）可以<strong>不管引用计数就激发TCP的正常连接终止序列</strong>。</p>
</li>
<li><p><strong>close只能同时终止两个方向的数据传送</strong></p>
<p>close 函数<strong>同时终止数据传送的两个方向：读和写</strong>。</p>
<p>但是TCP连接是全双工的，有时候我们需要关闭写但仍然可以继续读，shutdown 函数可以完成此工作。</p>
</li>
</ul>
<p>&#x3D;&#x3D;<strong>注意：</strong>&#x3D;&#x3D;</p>
<ol>
<li><p>如果有多个进程共享一个套接字，close 每被调用一次，计数减1，直到计数为0时，也就是所有进程都调用了close, 套接字将被释放。</p>
</li>
<li><p>在多进程中，如果一个进程调用shutdown(fd, SHUT_ RDWR)后其他的进程将无法利用此套接字进行通信。如果一个进程调用close(sfd)将不会影响到其他进程。</p>
</li>
</ol>
</li>
</ol>
<h2 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h2><h3 id="3-1-IPv4地址及网络地址转换NAT"><a href="#3-1-IPv4地址及网络地址转换NAT" class="headerlink" title="3.1 IPv4地址及网络地址转换NAT"></a>3.1 IPv4地址及网络地址转换NAT</h3><h4 id="IPv4"><a href="#IPv4" class="headerlink" title="IPv4"></a>IPv4</h4><p>连接在Internet的每台主机&#x2F;路由器都分配一个<strong>32bit</strong>的全球唯一的标识符。</p>
<p>IP地址的编码方式有三种：分类的IP地址、子网的划分、CIDR。</p>
<ul>
<li><p>分类的IP地址</p>
<p>传统的IP地址是分类的地址，分为A、B、C、D、E五类。均由网络号和主机号组成，网络号代表主机所连接到的网络，主机号代表该主机或路由器在网络中的地址。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220705093309767.png" alt="image-20220705093309767"></p>
<p>其中，存在一些特殊的IP地址用于表示特殊用途，不作为主机IP地址：</p>
<ul>
<li>主机号全为0表示本网络本身；</li>
<li>主机号全为1表示本网络的广播地址；</li>
<li>127.0.0.1网路保留作为环路自检地址，表示任意主机本身；</li>
<li>32bit全为0，即0.0.0.0表示整个TCP&#x2F;IP网络；</li>
<li>32bit全为1，即255.255.255.255表示整个TCP&#x2F;IP网络的广播地址。</li>
</ul>
</li>
<li><p>子网的划分、CIDR在下一节叙述。</p>
</li>
</ul>
<h4 id="网络地址转换"><a href="#网络地址转换" class="headerlink" title="网络地址转换"></a>网络地址转换</h4><p>网络地址转换（NAT）是通过将专用网络地址（比如企业内部网Intranet）转换为公用地址（如互联网Internet），从而对外隐藏了内部管理的IP地址。通过在内部使用非注册的IP地址（私有地址），并将它们转换为一小部分外部注册的IP地址（公有地址），从而减少IP地址注册的费用以及节省IPv4地址空间。</p>
<p>私有IP地址值用于局域网LAN，不用于无线局域网WLAN连接。因此私有IP地址不能直接用于Internet，必须通过网关利用NAT把私有IP地址转换为Intemet中合法的全球IP地址后才能用于Intermet。私有IP地址有效地解决了IP地址不足的问题。</p>
<p>私有IP地址网段如下:</p>
<blockquote>
<p><strong>10.0.0.0~10.255.255.255</strong>、<strong>172.16.0.0~172.31.255.255</strong>、 <strong>192.168.0.0~192.168.255.255</strong></p>
</blockquote>
<p>在因特网中的所有路由器，对目的地址是私有地址的数据报一律不进行转发。 使用NAT时，需要在专用网连接到因特网的路由器上安装NAT软件，NAT路由器至少有一个有效的外部全球地址。普通路由器在转发数据报时不改变其源IP地址和目的IP地址，且路由器工作在网络层，而<strong>NAT路由器在转发IP数据报时，一定要更换其IP地址（按路由器中的地址转换表转换源IP地址或目的IP地址）。NAT路由器转发数据报时需要查看和转换传输层的端口，其操作没有严格的层次关系</strong>。</p>
<h3 id="3-2-子网划分与子网掩码、CIDR"><a href="#3-2-子网划分与子网掩码、CIDR" class="headerlink" title="3.2 子网划分与子网掩码、CIDR"></a>3.2 子网划分与子网掩码、CIDR</h3><h4 id="子网划分"><a href="#子网划分" class="headerlink" title="子网划分"></a>子网划分</h4><p>各类地址的默认子网掩码：</p>
<p><strong>A类: 255.0.0.0</strong><br><strong>B类: 255.255.0.0</strong><br><strong>C类: 255.255.255.0</strong></p>
<p>使用子网划分时的地址格式：</p>
<p><strong>A类网络：8位    +  子网X位  +  主机24-X位</strong><br><strong>B类网络：16 位 +  子网X位  +  主机16-X位</strong><br><strong>C类网络：24位  +  子网X位  +  主机8-X位</strong></p>
<h4 id="无分类编址CIDR"><a href="#无分类编址CIDR" class="headerlink" title="无分类编址CIDR"></a>无分类编址CIDR</h4><p><strong>分类的IP地址的缺点：</strong></p>
<p>比如一个A类地址对应的是2^24 - 2个IP地址(网络地址和广播地址)，这个是个天文数字，一个公司或者组织是无法完全利用这么多IP地址的，就造成了IP地址的浪费。</p>
<p><strong>CIDR</strong>是在使用变长度子网掩码的基础上提出的一种消除传统A、B、C类网络划分，并且可以在软件的支持下实现超网构造的一种IP地址的网络划分方法。这样可以大幅度提高IP地址空间的利率，并减小路由表大小，提高路由器的路由转发能力。</p>
<p>无分类编址的做法是将IP分为两部分：</p>
<p>1、<strong>网络前缀</strong></p>
<p>网络号对应的是一个网络地址，一个网络可以容纳多个主机，主机的网络号相同。</p>
<p>2、<strong>主机号</strong></p>
<p>唯一标识一个主机在一个网络中的id。</p>
<p>怎么区分网络号和主机号呢？</p>
<p>使用斜线记法，即IP地址&#x2F;网络前缀所占比特数，xx:xx:xx:xx&#x2F;n<br>在IP地址后边加入了 &#x2F;n ，n代表前n位为网络号。</p>
<p>CIDR的主要特点：</p>
<ol>
<li><p>消除了传统的A、B、C类地址以及子网的概念，因而可以<strong>更加有效地分配IPv4的地址空间</strong>。CIDR使用“网络前缀”概念代替子网络概念。这样IP地址分为两部分:网络前缀、主机号。CIDR使用斜线记法，即IP地址&#x2F;网络前缀所占比特数。其中，网络前缀所占比特数对应于网络<br>的部分，等效于子网掩码中连续1的部分。</p>
</li>
<li><p>将网络前缀都相同的连续的IP地址组成“CIDR地址块”。一个CIDR地址块可以包括多个A、B、C类地址，这种地址的聚合称为<strong>路由聚合</strong>，或称为构成<strong>超网</strong>。路由聚合<strong>使得路由表中的一个项目可以表示很多个原来传统分类地址的路由</strong>，有利于减少路由之间的路由选择信息的交换，从而提高网络性能。</p>
</li>
</ol>
<h3 id="3-3-ARP、RARP、ICMP"><a href="#3-3-ARP、RARP、ICMP" class="headerlink" title="3.3 ARP、RARP、ICMP"></a>3.3 ARP、RARP、ICMP</h3><ul>
<li><p><strong>ARP</strong></p>
<p>在实际网络的数据链路上传送数据时，最终必须使用硬件地址MAC。所以需要一种方法来<strong>完成IP地址址到MAC地址的映射</strong>，这就要用到地址解析协议(Address Resolution Protocol, ARP)。 <strong>每台主机(路由器) 上单独地存放一个从IP地址到MAC地址的映射表，称为ARP表</strong>。主机和路由器使用地址解析协议APR来<strong>动态维护此ARP表</strong>。MAC地址转换为IP地址使用RARP协议。</p>
</li>
<li><p><strong>ICMP</strong></p>
<p>为了提高IP数据报成功交付的机会，在网络层使用了网际控制报文协议(Internet Control Message Protocol, ICMP) 来使得主机或路由器可以报告差错和异常情况。<br><strong>PING命令工作在应用层</strong>，但是<strong>直接使用网络层的ICMP协议</strong>，而**<u>没有使用传输层的TCP或UDP协议</u>**。</p>
</li>
</ul>
<h3 id="3-4-IPv6"><a href="#3-4-IPv6" class="headerlink" title="3.4 IPv6"></a>3.4 IPv6</h3><p>IPv6由<strong>128bit</strong>构成,通常使用冒号十六进制记法表示IPv6地址，每个16bit的值用四位十六进制值表示，各值之间用冒号分割，如68E6 : 8C64 : FFFFF : 0 : 1180 : 960A : FFFF。该表示方法允许使用零压缩，即一连串连续的零可以为一对冒号所取代，如DE08:0:0:0:0:0:0:B3可以写成DE08::B3；IP 地址0:0:0:0:0:0:118.17.23.1可以写成::118.17.23.1。（这里冒号分割的是16bit，点分割的是8bit）</p>
<p>IPv6所引入的主要变化：</p>
<ol>
<li>更大的地址空间。IPv6 将地址从IPv4的32bit增大到了128bit；</li>
<li>扩展的地址层次结构。</li>
<li>灵活的首部格式。</li>
<li>改进的选项。这一特征加快了分组处理速度。</li>
<li>允许协议继续扩充。</li>
<li>支持即插即用。</li>
<li>支持资源的预分配。</li>
<li>增加了安全性，身份验证和保密验证是IPv6的关键特征。</li>
<li>分片限制为由源点来完成，是端到端的，路由途中的路由器不允许进行分片。</li>
</ol>
<h2 id="网络常用测试工具"><a href="#网络常用测试工具" class="headerlink" title="网络常用测试工具"></a>网络常用测试工具</h2><h3 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h3><p>检查网络是否通畅或者网络的连接速度。</p>
<p>原理：利用网络上机器<strong>IP地址的唯一性</strong>，给目标IP地址发送一个数据包，再要求对方返回一个同样大小的数据包来确定两台网络机器是否连接相通、时延是多少。</p>
<h3 id="tracert"><a href="#tracert" class="headerlink" title="tracert"></a>tracert</h3><p>tracert是路由跟踪实用程序，<strong>用于确定IP数据包访问目标所采取的路径</strong>。</p>
<p>tracert 命令用<strong>IP生存时间(TTL) 字段</strong>和<strong>ICMP错误消息</strong>来确定从一个主机到网络上其他主机的路由。其命令格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tracert[-d] [-h maximum hops] [-j computer-list] [-W timeout] target_name</span><br></pre></td></tr></table></figure>


<p>可以使用tracert命令确定数据包在网络上的停止位置。例如：<code>tracert www.baidu.com</code>则会打印出从当前主机到目的主机所经过的路由地址。</p>
<h3 id="telnet"><a href="#telnet" class="headerlink" title="telnet"></a>telnet</h3><p>查看某个端口是否可访问。Telnet协议是TCP&#x2F;IP协议家族中的一员，是Internet远程登陆服务的标准协议和主要方式。它为用户提供了在本地计算机上完成远程主机工作的能力。</p>
<p>例如<strong>可以用telnet测试80端口的Web服务器是否正常工作</strong>。</p>
<p>输入<code>telnet www .hitsz.edu.cn 80</code></p>
<p>然后服务器响应:<br><code>Trying 219.223.252.3...</code><br><code>Connected to www .hitsz .edu. cn</code><br><code>Escape character is &#39;^] .</code></p>
<p>然后输入:<br><code>GET / HTTP1.1</code></p>
<p>如果Web服务器正常工作的话，就会返回服务器的响应头，以便你确认服务器的情况。</p>
<h3 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h3><p>netstat是一个监控TCP&#x2F;IP网络的非常有用的工具，它可以<strong>显示路由表、实际的网络连接以及每一个网络接口设备的状态信息</strong>。</p>
<p>netstat用于显示与IP、TCP、UDP和ICMP协议相关的统计数据，一般用于检验本机各端口的网络连接情况。使用格式为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat [-a][-e][-n][-o][-P Protocol] [-r] [-s] [Interval]</span><br></pre></td></tr></table></figure>

<p>一般用<code>netstat -an</code>来显示所有连接的端口并用数字表示。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">ccb</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://frankcao3.github.io/posts/28758">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://frankcao3.github.io/posts/28758')">计算机网络</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://frankcao3.github.io/posts/28758"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=计算机网络&amp;url=https://frankcao3.github.io/posts/28758&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>计算机基础<span class="tagsPageCount">5</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/1106"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">数据结构</div></div></a></div><div class="next-post pull-right"><a href="/posts/9423"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">STL</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/posts/9423" title="STL"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2021-08-15</div><div class="title">STL</div></div></a></div><div><a href="/posts/1106" title="数据结构"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2021-08-15</div><div class="title">数据结构</div></div></a></div><div><a href="/posts/50843" title="C&#x2F;C++ 基础知识"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2021-08-15</div><div class="title">C&#x2F;C++ 基础知识</div></div></a></div><div><a href="/posts/1079" title="操作系统"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2021-08-15</div><div class="title">操作系统</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C"><span class="toc-number">1.</span> <span class="toc-text">计算机网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.</span> <span class="toc-text">计算机网络模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-OSI%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 OSI参考模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-TCP-x2F-IP%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 TCP&#x2F;IP模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E5%B1%82%E4%B8%8Esocket%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.</span> <span class="toc-text">传输层与socket基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E4%BC%A0%E8%BE%93%E5%B1%82"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 传输层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#UDP"><span class="toc-number">1.2.1.0.1.</span> <span class="toc-text">UDP</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#TCP"><span class="toc-number">1.2.1.0.2.</span> <span class="toc-text">TCP</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-TCP%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%BB%BA%E7%AB%8B%E5%92%8C%E7%BB%88%E6%AD%A2"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 TCP连接的建立和终止</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">三次握手建立连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E9%87%8A%E6%94%BE%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">四次挥手释放连接</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-TCP%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2%E5%9B%BE"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 TCP状态转换图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-socket%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 socket的基本操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82"><span class="toc-number">1.3.</span> <span class="toc-text">网络层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-IPv4%E5%9C%B0%E5%9D%80%E5%8F%8A%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2NAT"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 IPv4地址及网络地址转换NAT</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IPv4"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">IPv4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">网络地址转换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86%E4%B8%8E%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%E3%80%81CIDR"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 子网划分与子网掩码、CIDR</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">子网划分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E5%88%86%E7%B1%BB%E7%BC%96%E5%9D%80CIDR"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">无分类编址CIDR</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-ARP%E3%80%81RARP%E3%80%81ICMP"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 ARP、RARP、ICMP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-IPv6"><span class="toc-number">1.3.4.</span> <span class="toc-text">3.4 IPv6</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B8%B8%E7%94%A8%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7"><span class="toc-number">1.4.</span> <span class="toc-text">网络常用测试工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ping"><span class="toc-number">1.4.1.</span> <span class="toc-text">ping</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tracert"><span class="toc-number">1.4.2.</span> <span class="toc-text">tracert</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#telnet"><span class="toc-number">1.4.3.</span> <span class="toc-text">telnet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#netstat"><span class="toc-number">1.4.4.</span> <span class="toc-text">netstat</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/16107" title="Hello World">Hello World</a><time datetime="2023-10-05T11:40:46.695Z" title="Created 2023-10-05 19:40:46">2023-10-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/34953" title="渗透测试全流程">渗透测试全流程</a><time datetime="2022-08-04T16:00:00.000Z" title="Created 2022-08-05 00:00:00">2022-08-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/39395" title="基础概念与信息收集">基础概念与信息收集</a><time datetime="2022-08-04T16:00:00.000Z" title="Created 2022-08-05 00:00:00">2022-08-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/57467" title="XXE">XXE</a><time datetime="2022-08-04T16:00:00.000Z" title="Created 2022-08-05 00:00:00">2022-08-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/58219" title="反序列化漏洞">反序列化漏洞</a><time datetime="2022-08-04T16:00:00.000Z" title="Created 2022-08-05 00:00:00">2022-08-05</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2023 By <a class="footer-bar-link" href="/" title="ccb" target="_blank">ccb</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">40</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/DVWA%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">DVWA靶场<sup>10</sup></a><a href="/tags/%E5%AE%9E%E8%AE%AD-%E7%BD%91%E7%BB%9C%E5%BB%BA%E8%AE%BE%E9%83%A8%E5%88%86/" style="font-size: 0.88rem;">实训-网络建设部分<sup>7</sup></a><a href="/tags/%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" style="font-size: 0.88rem;">搭建博客<sup>1</sup></a><a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 0.88rem;">机器学习<sup>1</sup></a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 0.88rem;">渗透测试<sup>15</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">计算机基础<sup>5</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.8",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 ccb 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>